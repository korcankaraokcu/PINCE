<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>libpince.debugcore &#8212; PINCE  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for libpince.debugcore</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Copyright (C) 2016-2017 Korcan Karaok√ßu &lt;korcankaraokcu@gmail.com&gt;</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">Thread</span><span class="p">,</span> <span class="n">Condition</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pexpect</span><span class="o">,</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">ctypes</span><span class="o">,</span><span class="w"> </span><span class="nn">pickle</span><span class="o">,</span><span class="w"> </span><span class="nn">shelve</span><span class="o">,</span><span class="w"> </span><span class="nn">re</span><span class="o">,</span><span class="w"> </span><span class="nn">struct</span><span class="o">,</span><span class="w"> </span><span class="nn">io</span><span class="o">,</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">typedefs</span><span class="p">,</span> <span class="n">regexes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.libscanmem.scanmem</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scanmem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.libptrscan.ptrscan</span><span class="w"> </span><span class="kn">import</span> <span class="n">PointerScan</span>

<span class="n">self_pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">&quot;libc.so.6&quot;</span><span class="p">)</span>
<span class="n">system_endianness</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ENDIANNESS</span><span class="o">.</span><span class="n">LITTLE</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s2">&quot;little&quot;</span> <span class="k">else</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ENDIANNESS</span><span class="o">.</span><span class="n">BIG</span>

<span class="n">scanmem</span> <span class="o">=</span> <span class="n">Scanmem</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_libpince_directory</span><span class="p">(),</span> <span class="s2">&quot;libscanmem&quot;</span><span class="p">,</span> <span class="s2">&quot;libscanmem.so&quot;</span><span class="p">))</span>
<span class="n">ptrscan</span> <span class="o">=</span> <span class="n">PointerScan</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_libpince_directory</span><span class="p">(),</span> <span class="s2">&quot;libptrscan&quot;</span><span class="p">,</span> <span class="s2">&quot;libptrscan.so&quot;</span><span class="p">))</span>
<span class="n">ptrscan</span><span class="o">.</span><span class="n">set_pointer_offset_symbol</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)</span>

<span class="c1"># A boolean value. True if gdb is initialized, False if not</span>
<span class="n">gdb_initialized</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># An integer. Can be a member of typedefs.INFERIOR_ARCH</span>
<span class="n">inferior_arch</span> <span class="o">=</span> <span class="nb">int</span>

<span class="c1"># An integer. Can be a member of typedefs.INFERIOR_STATUS</span>
<span class="n">inferior_status</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># An integer. PID of the current attached/created process</span>
<span class="n">currentpid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># An integer. Can be a member of typedefs.STOP_REASON</span>
<span class="n">stop_reason</span> <span class="o">=</span> <span class="nb">int</span>

<span class="c1"># A dictionary. Holds breakpoint numbers and what to do on hit</span>
<span class="c1"># Format: {bp_num1:on_hit1, bp_num2:on_hit2, ...}</span>
<span class="n">breakpoint_on_hit_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># A dictionary. Holds address and aob of instructions that were nop&#39;ed out</span>
<span class="c1"># Format: {address1:orig_instruction1_aob, address2:orig_instruction2_aob, ...}</span>
<span class="n">modified_instructions_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># If an action such as deletion or condition modification happens in one of the breakpoints in a list, others in the</span>
<span class="c1"># same list will get affected as well</span>
<span class="c1"># Format: [[[address1, size1], [address2, size2], ...], [[address1, size1], ...], ...]</span>
<span class="n">chained_breakpoints</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">child</span> <span class="o">=</span> <span class="nb">object</span>  <span class="c1"># this object will be used with pexpect operations</span>

<span class="c1"># This Lock is used by the function send_command to ensure synchronous execution</span>
<span class="n">lock_send_command</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>

<span class="c1"># This condition is notified whenever status of the inferior changes</span>
<span class="c1"># Use the variable inferior_status to get information about inferior&#39;s status</span>
<span class="c1"># See CheckInferiorStatus class for an example</span>
<span class="n">status_changed_condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>

<span class="c1"># This condition is notified if the current inferior gets terminated</span>
<span class="c1"># See AwaitProcessExit class for an example</span>
<span class="n">process_exited_condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>

<span class="c1"># This condition is notified if gdb starts to wait for the prompt output</span>
<span class="c1"># See function send_command for an example</span>
<span class="n">gdb_waiting_for_prompt_condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>

<span class="c1"># A string. Stores the output of the last command</span>
<span class="n">gdb_output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># An instance of typedefs.RegisterQueue. Updated whenever GDB receives an async event such as breakpoint modification</span>
<span class="c1"># See AwaitAsyncOutput class for an example of usage</span>
<span class="n">gdb_async_output</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">RegisterQueue</span><span class="p">()</span>

<span class="c1"># A boolean value. Used to cancel the last gdb command sent</span>
<span class="c1"># Use the function cancel_ongoing_command to make use of this variable</span>
<span class="c1"># Return value of the current send_command call will be an empty string</span>
<span class="n">cancel_send_command</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># A boolean value. Used by state_observe_thread to check if a trace session is active</span>
<span class="n">active_trace</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># A boolean value. Set to True when a tracking breakpoint (on_hit != BREAK) was the last stop</span>
<span class="c1"># This prevents the subsequent *running event from notifying the UI</span>
<span class="n">last_stop_was_tracking</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># A string. Holds the last command sent to gdb</span>
<span class="n">last_gdb_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># A list of booleans. Used to adjust gdb output</span>
<span class="c1"># Use the function set_gdb_output_mode to make use of this variable</span>
<span class="n">gdb_output_mode</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">gdb_output_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># A string. memory file of the currently attached/created process</span>
<span class="n">mem_file</span> <span class="o">=</span> <span class="s2">&quot;/proc/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/mem&quot;</span>

<span class="c1"># A string. Determines which signal to use to interrupt the process</span>
<span class="n">interrupt_signal</span> <span class="o">=</span> <span class="s2">&quot;SIGINT&quot;</span>

<span class="c1"># Dictionary that maps an id or name to allocated memory.</span>
<span class="c1"># If an user allocates memory without a name, it will be given a random ID set as string.</span>
<span class="n">allocated_memory_chunks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">AllocatedMemory</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># ID generator used for the above</span>
<span class="n">allocated_memory_gen_id</span> <span class="o">=</span> <span class="mi">0</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">When PINCE was first launched, it used gdb 7.7.1, which is a very outdated version of gdb</span>
<span class="sd">interpreter-exec mi command of gdb showed some buggy behaviour at that time</span>
<span class="sd">Because of that, PINCE couldn&#39;t support gdb/mi commands for a while</span>
<span class="sd">But PINCE is now updated with the new versions of gdb as much as possible and the interpreter-exec works much better</span>
<span class="sd">So, old parts of codebase still get their required information by parsing gdb console output</span>
<span class="sd">New parts can try to rely on gdb/mi output</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions that require breakpoint commands, such as track_watchpoint and track_breakpoint, requires process to be</span>
<span class="sd">stopped beforehand. If the process is running before we give the breakpoint its commands, there&#39;s a chance that the</span>
<span class="sd">breakpoint will be triggered before we give it commands. The process must be stopped to avoid this race condition</span>
<span class="sd">It&#39;s also necessary to stop the process to run commands like &quot;watch&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="set_gdb_output_mode">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.set_gdb_output_mode">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_gdb_output_mode</span><span class="p">(</span><span class="n">output_mode_tuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjusts gdb output</span>

<span class="sd">    Args:</span>
<span class="sd">        output_mode_tuple (typedefs.gdb_output_mode): Setting any field True will enable the output that&#39;s associated</span>
<span class="sd">        with that field. Setting it False will disable the associated output</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">gdb_output_mode</span>
    <span class="n">gdb_output_mode</span> <span class="o">=</span> <span class="n">output_mode_tuple</span></div>



<div class="viewcode-block" id="cancel_ongoing_command">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.cancel_ongoing_command">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cancel_ongoing_command</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cancels the last gdb command sent if it&#39;s still present</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if cancel was successful, False if nothing to cancel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lock_send_command</span><span class="o">.</span><span class="n">locked</span><span class="p">():</span>
        <span class="k">global</span> <span class="n">cancel_send_command</span>
        <span class="n">cancel_send_command</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="send_command">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.send_command">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">send_command</span><span class="p">(</span>
    <span class="n">command</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cli_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Issues the command sent, raises an exception if gdb isn&#39;t initiated</span>

<span class="sd">    Args:</span>
<span class="sd">        command (str): The command that&#39;ll be sent</span>
<span class="sd">        control (bool): This param should be True if the command sent is ctrl+key instead of the regular command</span>
<span class="sd">        cli_output (bool): If True, returns a readable cli output instead of gdb/mi output</span>
<span class="sd">        send_with_file (bool): Custom commands declared in gdbextensions.py requires file communication. If</span>
<span class="sd">        called command has any parameters, pass this as True</span>
<span class="sd">        file_contents_send (any): Arguments for the custom gdb command called</span>
<span class="sd">        recv_with_file (bool): Pass this as True if the called custom gdb command returns something</span>

<span class="sd">    Examples:</span>
<span class="sd">        send_command(c,control=True)--&gt; Sends ctrl+c instead of the str &quot;c&quot;</span>
<span class="sd">        send_command(&quot;pince-read-addresses&quot;, file_contents_send=nested_list, recv_file=True)--&gt; This line calls the</span>
<span class="sd">        custom gdb command &quot;pince-read-addresses&quot; with parameter nested_list and since that gdb command returns the</span>
<span class="sd">        addresses read as a list, we also pass the parameter recv_file as True</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Result of the command sent, commands in the form of &quot;ctrl+key&quot; always returns a null string</span>
<span class="sd">        ???: If recv_with_file is True. Content of the returned thing depends on the command sent</span>

<span class="sd">    Note:</span>
<span class="sd">        TODO:This bug doesn&#39;t seem like to exist anymore. Remove the unnecessary file communication layer of IPC</span>
<span class="sd">        File communication system is used to avoid BEL emitting bug of pexpect. If you send more than a certain amount</span>
<span class="sd">        of characters to gdb, the input will be sheared at somewhere and gdb won&#39;t be receiving all of the input</span>
<span class="sd">        Visit this page for more information--&gt;http://pexpect.readthedocs.io/en/stable/commonissues.html</span>

<span class="sd">        You don&#39;t have to write interpreter-exec while sending a gdb/mi command. Just pass the gdb/mi command as itself.</span>
<span class="sd">        This function will convert it automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">child</span>
    <span class="k">global</span> <span class="n">gdb_output</span>
    <span class="k">global</span> <span class="n">cancel_send_command</span>
    <span class="k">global</span> <span class="n">last_gdb_command</span>
    <span class="k">with</span> <span class="n">lock_send_command</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gdb_output_mode</span><span class="o">.</span><span class="n">command_info</span><span class="p">:</span>
            <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gdb_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">GDBInitializeException</span>
        <span class="n">gdb_output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">send_with_file</span><span class="p">:</span>
            <span class="n">send_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_from_pince_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">file_contents_send</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">send_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">recv_with_file</span> <span class="ow">or</span> <span class="n">cli_output</span><span class="p">:</span>
            <span class="n">recv_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_to_pince_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span>

            <span class="c1"># Truncating the recv_file because we wouldn&#39;t like to see output of previous command in case of errors</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">recv_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">command</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;interpreter-exec mi &quot;&#39;</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">command</span>
        <span class="n">last_gdb_command</span> <span class="o">=</span> <span class="n">command</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">control</span> <span class="k">else</span> <span class="s2">&quot;Ctrl+&quot;</span> <span class="o">+</span> <span class="n">command</span>
        <span class="k">if</span> <span class="n">gdb_output_mode</span><span class="o">.</span><span class="n">command_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Last command: &quot;</span> <span class="o">+</span> <span class="n">last_gdb_command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">sendcontrol</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_gdb_command_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span>
            <span class="n">command_fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">command_file</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span>
            <span class="n">command_fd</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
            <span class="n">command_fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">command_fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cli_output</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;source &quot;</span> <span class="o">+</span> <span class="n">command_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;cli-output source &quot;</span> <span class="o">+</span> <span class="n">command_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">control</span><span class="p">:</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">gdb_output</span><span class="p">:</span>
                <span class="n">sleep</span><span class="p">(</span><span class="n">typedefs</span><span class="o">.</span><span class="n">CONST_TIME</span><span class="o">.</span><span class="n">GDB_INPUT_SLEEP</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cancel_send_command</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cancel_send_command</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recv_with_file</span> <span class="ow">or</span> <span class="n">cli_output</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">recv_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">gdb_output</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendcontrol</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">gdb_waiting_for_prompt_condition</span><span class="p">:</span>
                    <span class="n">gdb_waiting_for_prompt_condition</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gdb_output_mode</span><span class="o">.</span><span class="n">command_info</span><span class="p">:</span>
            <span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">time1</span> <span class="o">-</span> <span class="n">time0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">cancel_send_command</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">output</span></div>



<div class="viewcode-block" id="state_observe_thread">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.state_observe_thread">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">state_observe_thread</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Observes the state of gdb, uses conditions to inform other functions and threads about gdb&#39;s state</span>
<span class="sd">    Also generates output for send_command function</span>
<span class="sd">    Should be called by creating a thread. Usually called in initialization process by attach function</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_inferior_status</span><span class="p">():</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">gdb_state_observe</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">global</span> <span class="n">stop_reason</span>
            <span class="k">global</span> <span class="n">inferior_status</span>
            <span class="k">global</span> <span class="n">last_stop_was_tracking</span>
            <span class="n">old_status</span> <span class="o">=</span> <span class="n">inferior_status</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;stopped,reason=&quot;exited&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">process_exited_condition</span><span class="p">:</span>
                        <span class="n">detach</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Process terminated (PID:</span><span class="si">{</span><span class="n">currentpid</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                        <span class="n">process_exited_condition</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>
                        <span class="k">return</span>

            <span class="c1"># For multiline outputs, only the last async event is important</span>
            <span class="c1"># Get the last match only to optimize parsing</span>
            <span class="n">stop_info</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">stop_info</span><span class="p">:</span>
                <span class="n">stop_reason</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">STOP_REASON</span><span class="o">.</span><span class="n">DEBUG</span>
                <span class="n">inferior_status</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_STATUS</span><span class="o">.</span><span class="n">STOPPED</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inferior_status</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_STATUS</span><span class="o">.</span><span class="n">RUNNING</span>

            <span class="c1"># Check if the FINAL stopped event in this batch is a tracking breakpoint</span>
            <span class="c1"># We need to check the last *stopped event, not just any tracking bp in the batch</span>
            <span class="c1"># Because there might be multiple events arriving in same buffer</span>
            <span class="k">if</span> <span class="n">inferior_status</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_STATUS</span><span class="o">.</span><span class="n">STOPPED</span><span class="p">:</span>
                <span class="c1"># Find the LAST stopped event in matches (working backwards)</span>
                <span class="n">last_stop_was_tracking</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># This is a *stopped event</span>
                        <span class="n">bp_match</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">breakpoint_number</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">bp_match</span><span class="p">:</span>
                            <span class="n">bp_num_str</span> <span class="o">=</span> <span class="n">bp_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">bp_on_hit</span> <span class="o">=</span> <span class="n">breakpoint_on_hit_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bp_num_str</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">last_stop_was_tracking</span> <span class="o">=</span> <span class="n">bp_on_hit</span> <span class="o">!=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_ON_HIT</span><span class="o">.</span><span class="n">BREAK</span>
                        <span class="c1"># Found the last stopped event, stop searching</span>
                        <span class="k">break</span>
            <span class="c1"># If we ended in RUNNING state, last_stop_was_tracking persists from previous STOPPED event</span>

            <span class="c1"># Don&#39;t notify UI if:</span>
            <span class="c1"># 1. Status hasn&#39;t changed</span>
            <span class="c1"># 2. Last stop was a tracking breakpoint</span>
            <span class="c1"># 3. A trace is active</span>
            <span class="n">should_not_notify</span> <span class="o">=</span> <span class="n">old_status</span> <span class="o">==</span> <span class="n">inferior_status</span> <span class="ow">or</span> <span class="n">last_stop_was_tracking</span> <span class="ow">or</span> <span class="n">active_trace</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">should_not_notify</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">status_changed_condition</span><span class="p">:</span>
                    <span class="n">status_changed_condition</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>

    <span class="k">global</span> <span class="n">child</span>
    <span class="k">global</span> <span class="n">gdb_output</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">expect_exact</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># A new line for TTY devices</span>
            <span class="n">child</span><span class="o">.</span><span class="n">before</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">check_inferior_status</span><span class="p">()</span>
            <span class="n">command_file</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_gdb_command_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">gdb_command_source</span><span class="p">(</span><span class="n">command_file</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">expect_exact</span><span class="p">(</span><span class="s2">&quot;(gdb)&quot;</span><span class="p">)</span>
                <span class="n">child</span><span class="o">.</span><span class="n">before</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">check_inferior_status</span><span class="p">()</span>
                <span class="n">gdb_output</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span>
                <span class="k">with</span> <span class="n">gdb_waiting_for_prompt_condition</span><span class="p">:</span>
                    <span class="n">gdb_waiting_for_prompt_condition</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">gdb_output_mode</span><span class="o">.</span><span class="n">command_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">gdb_output_mode</span><span class="o">.</span><span class="n">async_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
                <span class="n">gdb_async_output</span><span class="o">.</span><span class="n">broadcast_message</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">EOF exception caught within pexpect, here&#39;s the contents of child.before:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting state_observe_thread&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="execute_func_temporary_interruption">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.execute_func_temporary_interruption">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">execute_func_temporary_interruption</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interrupts the inferior before executing the given function, continues inferior&#39;s execution after calling the</span>
<span class="sd">    given function</span>

<span class="sd">    !!!WARNING!!! This function is NOT thread-safe. Use it with caution!</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function): The function that&#39;ll be called between interrupt&amp;continue routine</span>
<span class="sd">        *args (args): Arguments for the function that&#39;ll be called</span>
<span class="sd">        **kwargs (kwargs): Keyword arguments for the function that&#39;ll be called</span>

<span class="sd">    Returns:</span>
<span class="sd">        ???: Result of the given function. Return type depends on the given function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_status</span> <span class="o">=</span> <span class="n">inferior_status</span>
    <span class="k">if</span> <span class="n">old_status</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_STATUS</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
        <span class="n">interrupt_inferior</span><span class="p">(</span><span class="n">typedefs</span><span class="o">.</span><span class="n">STOP_REASON</span><span class="o">.</span><span class="n">PAUSE</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">old_status</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_STATUS</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
        <span class="n">continue_inferior</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="execute_with_temporary_interruption">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.execute_with_temporary_interruption">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">execute_with_temporary_interruption</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator version of execute_func_temporary_interruption&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">execute_func_temporary_interruption</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="can_attach">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.can_attach">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">can_attach</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we can attach to the target</span>

<span class="sd">    Args:</span>
<span class="sd">        pid (int,str): PID of the process that&#39;ll be attached</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if attaching is successful, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">ptrace</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 16 is PTRACE_ATTACH, check ptrace.h for details</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">os</span><span class="o">.</span><span class="n">waitpid</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">libc</span><span class="o">.</span><span class="n">ptrace</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>  <span class="c1"># 17 is PTRACE_DETACH, check ptrace.h for details</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="wait_for_stop">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.wait_for_stop">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_stop</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Block execution till the inferior stops</span>

<span class="sd">    Args:</span>
<span class="sd">        timeout (float): Timeout time in seconds, passing 0 will wait for stop indefinitely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">remaining_time</span> <span class="o">=</span> <span class="n">timeout</span>
    <span class="k">while</span> <span class="n">inferior_status</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_STATUS</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">remaining_time</span> <span class="o">-=</span> <span class="mf">0.0001</span>
        <span class="k">if</span> <span class="n">remaining_time</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span></div>



<div class="viewcode-block" id="interrupt_inferior">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.interrupt_inferior">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">interrupt_inferior</span><span class="p">(</span><span class="n">interrupt_reason</span><span class="o">=</span><span class="n">typedefs</span><span class="o">.</span><span class="n">STOP_REASON</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interrupt the inferior</span>

<span class="sd">    Args:</span>
<span class="sd">        interrupt_reason (int): Just changes the global variable stop_reason. Can be a member of typedefs.STOP_REASON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">currentpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">global</span> <span class="n">stop_reason</span>
    <span class="k">if</span> <span class="n">interrupt_signal</span> <span class="o">==</span> <span class="s2">&quot;SIGINT&quot;</span><span class="p">:</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;interrupt&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">inferior_status</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_STATUS</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
        <span class="n">sig_num</span> <span class="o">=</span> <span class="n">interrupt_signal</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">sig_num</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;kill -</span><span class="si">{</span><span class="n">sig_num</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currentpid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;kill -s </span><span class="si">{</span><span class="n">interrupt_signal</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">currentpid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">wait_for_stop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">stop_reason</span> <span class="o">=</span> <span class="n">interrupt_reason</span></div>



<div class="viewcode-block" id="continue_inferior">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.continue_inferior">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">continue_inferior</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Continue the inferior&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">currentpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;c&amp;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="step_instruction">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.step_instruction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">step_instruction</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Step one assembly instruction&quot;&quot;&quot;</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;stepi&amp;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="step_over_instruction">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.step_over_instruction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">step_over_instruction</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Step over one assembly instruction&quot;&quot;&quot;</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;nexti&amp;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="execute_till_return">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.execute_till_return">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">execute_till_return</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Continues inferior till current stack frame returns&quot;&quot;&quot;</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;finish&amp;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="set_interrupt_signal">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.set_interrupt_signal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_interrupt_signal</span><span class="p">(</span><span class="n">signal_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decides on what signal to use to stop the process</span>

<span class="sd">    Args:</span>
<span class="sd">        signal_name (str): Name of the signal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">interrupt_signal</span>
    <span class="n">handle_signal</span><span class="p">(</span><span class="n">signal_name</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">interrupt_signal</span> <span class="o">=</span> <span class="n">signal_name</span></div>



<div class="viewcode-block" id="handle_signal">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.handle_signal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_signal</span><span class="p">(</span><span class="n">signal_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">pass_to_program</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decides on what will GDB do when the process recieves a signal</span>

<span class="sd">    Args:</span>
<span class="sd">        signal_name (str): Name of the signal</span>
<span class="sd">        stop (bool): Stop the program and print to the console</span>
<span class="sd">        pass_to_program (bool): Pass signal to program</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[[</span><span class="n">signal_name</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">pass_to_program</span><span class="p">]]</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-handle-signals&quot;</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="n">params</span><span class="p">)</span></div>



<div class="viewcode-block" id="handle_signals">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.handle_signals">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_signals</span><span class="p">(</span><span class="n">signal_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimized version of handle_signal for multiple signals</span>

<span class="sd">    Args:</span>
<span class="sd">        signal_list (list): A list of the parameters of handle_signal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-handle-signals&quot;</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="n">signal_list</span><span class="p">)</span></div>



<div class="viewcode-block" id="init_gdb">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.init_gdb">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">init_gdb</span><span class="p">(</span><span class="n">gdb_path</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">get_default_gdb_path</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Spawns gdb and initializes/resets some of the global variables</span>

<span class="sd">    Args:</span>
<span class="sd">        gdb_path (str): Path of the gdb binary</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if initialization is successful, False otherwise</span>

<span class="sd">    Note:</span>
<span class="sd">        Calling init_gdb() will reset the current session</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">child</span>
    <span class="k">global</span> <span class="n">gdb_initialized</span>
    <span class="k">global</span> <span class="n">breakpoint_on_hit_dict</span>
    <span class="k">global</span> <span class="n">chained_breakpoints</span>
    <span class="k">global</span> <span class="n">gdb_output</span>
    <span class="k">global</span> <span class="n">cancel_send_command</span>
    <span class="k">global</span> <span class="n">last_gdb_command</span>
    <span class="k">global</span> <span class="n">last_stop_was_tracking</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">init_user_files</span><span class="p">()</span>
    <span class="n">detach</span><span class="p">()</span>

    <span class="c1"># Temporary IPC_PATH, this little hack is needed because send_command requires a valid IPC_PATH</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">create_ipc_path</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">create_tmp_path</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span>

    <span class="n">breakpoint_on_hit_dict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">chained_breakpoints</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">gdb_output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cancel_send_command</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">last_gdb_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">last_stop_was_tracking</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">libpince_dir</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_libpince_directory</span><span class="p">()</span>
    <span class="n">is_appimage</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;APPDIR&quot;</span><span class="p">)</span>
    <span class="n">python_home_env</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;PYTHONHOME=</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PYTHONHOME&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">is_appimage</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;sudo -E --preserve-env=PATH LC_NUMERIC=C </span><span class="si">{</span><span class="n">python_home_env</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">gdb_path</span><span class="si">}</span><span class="s2"> --nx --interpreter=mi&quot;</span><span class="p">,</span>
        <span class="n">cwd</span><span class="o">=</span><span class="n">libpince_dir</span><span class="p">,</span>
        <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
        <span class="n">codec_errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">child</span><span class="o">.</span><span class="n">setecho</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">child</span><span class="o">.</span><span class="n">delaybeforesend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">child</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">child</span><span class="o">.</span><span class="n">expect_exact</span><span class="p">(</span><span class="s2">&quot;(gdb)&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">EOF exception caught within pexpect, here&#39;s the contents of child.before:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">status_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">state_observe_thread</span><span class="p">)</span>
    <span class="n">status_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">status_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">gdb_initialized</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">set_logging</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_appimage</span><span class="p">:</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;source ./gdbinit_venv&quot;</span><span class="p">)</span>
    <span class="n">set_pince_paths</span><span class="p">()</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;source &quot;</span> <span class="o">+</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_user_path</span><span class="p">(</span><span class="n">typedefs</span><span class="o">.</span><span class="n">USER_PATHS</span><span class="o">.</span><span class="n">GDBINIT</span><span class="p">))</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_user_path</span><span class="p">(</span><span class="n">typedefs</span><span class="o">.</span><span class="n">USER_PATHS</span><span class="o">.</span><span class="n">PINCEINIT</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="set_logging">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.set_logging">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_logging</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets logging on or off</span>

<span class="sd">    Args:</span>
<span class="sd">        state (bool): Sets logging on if True, off if False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set logging enabled off&quot;</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set logging file &quot;</span> <span class="o">+</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_logging_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set logging enabled on&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="set_pince_paths">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.set_pince_paths">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_pince_paths</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes $PINCE_PATH and $GDBINIT_AA_PATH convenience variables to make commands in gdbextensions.py</span>
<span class="sd">    and gdbutils.py work. GDB scripts need to know libpince and .config directories, unfortunately they don&#39;t start</span>
<span class="sd">    from the place where script exists</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">libpince_dir</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_libpince_directory</span><span class="p">()</span>
    <span class="n">pince_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">libpince_dir</span><span class="p">)</span>
    <span class="n">gdbinit_aa_dir</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_user_path</span><span class="p">(</span><span class="n">typedefs</span><span class="o">.</span><span class="n">USER_PATHS</span><span class="o">.</span><span class="n">GDBINIT_AA</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set $GDBINIT_AA_PATH=&quot;</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">gdbinit_aa_dir</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set $PINCE_PATH=&quot;</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">pince_dir</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;source gdb_python_scripts/gdbextensions.py&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="init_referenced_dicts">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.init_referenced_dicts">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">init_referenced_dicts</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes referenced dict shelve databases</span>

<span class="sd">    Args:</span>
<span class="sd">        pid (int,str): PID of the attached process</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_referenced_strings_file</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
    <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_referenced_jumps_file</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
    <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_referenced_calls_file</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="attach">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.attach">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">attach</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">gdb_path</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">get_default_gdb_path</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attaches gdb to the target and initializes some of the global variables</span>

<span class="sd">    Args:</span>
<span class="sd">        pid (int,str): PID of the process that&#39;ll be attached to</span>
<span class="sd">        gdb_path (str): Path of the gdb binary</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: A member of typedefs.ATTACH_RESULT</span>

<span class="sd">    Note:</span>
<span class="sd">        If gdb is already initialized, gdb_path will be ignored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">currentpid</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">traced_by</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_traced</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">pid_control_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Attaching PINCE to itself makes PINCE freeze immediately because gdb freezes the target on attach</span>
        <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">pid</span> <span class="o">==</span> <span class="n">self_pid</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ATTACH_RESULT</span><span class="o">.</span><span class="n">ATTACH_SELF</span><span class="p">),</span>
        <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_process_valid</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ATTACH_RESULT</span><span class="o">.</span><span class="n">PROCESS_NOT_VALID</span><span class="p">),</span>
        <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">pid</span> <span class="o">==</span> <span class="n">currentpid</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ATTACH_RESULT</span><span class="o">.</span><span class="n">ALREADY_DEBUGGING</span><span class="p">),</span>
        <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">traced_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ATTACH_RESULT</span><span class="o">.</span><span class="n">ALREADY_TRACED</span><span class="p">),</span>
        <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="ow">not</span> <span class="n">can_attach</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ATTACH_RESULT</span><span class="o">.</span><span class="n">PERM_DENIED</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">control_func</span><span class="p">,</span> <span class="n">attach_result</span> <span class="ow">in</span> <span class="n">pid_control_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">control_func</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">attach_result</span>
    <span class="k">if</span> <span class="n">currentpid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">gdb_initialized</span><span class="p">:</span>
        <span class="n">init_gdb</span><span class="p">(</span><span class="n">gdb_path</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">inferior_arch</span>
    <span class="k">global</span> <span class="n">mem_file</span>
    <span class="n">currentpid</span> <span class="o">=</span> <span class="n">pid</span>
    <span class="n">mem_file</span> <span class="o">=</span> <span class="s2">&quot;/proc/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/mem&quot;</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">create_ipc_path</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">create_tmp_path</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;attach &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
    <span class="n">set_pince_paths</span><span class="p">()</span>
    <span class="n">init_referenced_dicts</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">inferior_arch</span> <span class="o">=</span> <span class="n">get_inferior_arch</span><span class="p">()</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_user_path</span><span class="p">(</span><span class="n">typedefs</span><span class="o">.</span><span class="n">USER_PATHS</span><span class="o">.</span><span class="n">PINCEINIT_AA</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ATTACH_RESULT</span><span class="o">.</span><span class="n">SUCCESSFUL</span></div>



<div class="viewcode-block" id="create_process">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.create_process">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_process</span><span class="p">(</span><span class="n">process_path</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ld_preload_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">gdb_path</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">get_default_gdb_path</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a new process for debugging and initializes some of the global variables</span>
<span class="sd">    Current process will be detached even if the create_process call fails</span>
<span class="sd">    Make sure to save your data before calling this monstrosity</span>

<span class="sd">    Args:</span>
<span class="sd">        process_path (str): Absolute path of the target binary</span>
<span class="sd">        args (str): Arguments of the inferior, optional</span>
<span class="sd">        ld_preload_path (str): Path of the preloaded .so file, optional</span>
<span class="sd">        gdb_path (str): Path of the gdb binary</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the process has been created successfully, False otherwise</span>

<span class="sd">    Note:</span>
<span class="sd">        If gdb is already initialized, gdb_path will be ignored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">currentpid</span>
    <span class="k">global</span> <span class="n">inferior_arch</span>
    <span class="k">global</span> <span class="n">mem_file</span>
    <span class="k">if</span> <span class="n">currentpid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">gdb_initialized</span><span class="p">:</span>
        <span class="n">init_gdb</span><span class="p">(</span><span class="n">gdb_path</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;file &quot;</span> <span class="o">+</span> <span class="n">process_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">gdb_error</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An error occurred while trying to create process from the file at &quot;</span> <span class="o">+</span> <span class="n">process_path</span><span class="p">)</span>
        <span class="n">detach</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;starti&quot;</span><span class="p">)</span>
    <span class="n">wait_for_stop</span><span class="p">()</span>
    <span class="n">entry_point</span> <span class="o">=</span> <span class="n">find_entry_point</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">entry_point</span><span class="p">:</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;tbreak *&quot;</span> <span class="o">+</span> <span class="n">entry_point</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;tbreak _start&quot;</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set args &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ld_preload_path</span><span class="p">:</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set exec-wrapper env &#39;LD_PRELOAD=&quot;</span> <span class="o">+</span> <span class="n">ld_preload_path</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">)</span>

    <span class="c1"># We have to wait till breakpoint hits</span>
    <span class="n">wait_for_stop</span><span class="p">()</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="n">get_inferior_pid</span><span class="p">()</span>
    <span class="n">currentpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">mem_file</span> <span class="o">=</span> <span class="s2">&quot;/proc/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/mem&quot;</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">create_ipc_path</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">create_tmp_path</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">set_pince_paths</span><span class="p">()</span>
    <span class="n">init_referenced_dicts</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">inferior_arch</span> <span class="o">=</span> <span class="n">get_inferior_arch</span><span class="p">()</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_user_path</span><span class="p">(</span><span class="n">typedefs</span><span class="o">.</span><span class="n">USER_PATHS</span><span class="o">.</span><span class="n">PINCEINIT_AA</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="detach">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.detach">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">detach</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;See you, space cowboy&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">gdb_initialized</span>
    <span class="k">global</span> <span class="n">currentpid</span>
    <span class="n">old_pid</span> <span class="o">=</span> <span class="n">currentpid</span>
    <span class="k">if</span> <span class="n">gdb_initialized</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">child</span>
        <span class="k">global</span> <span class="n">inferior_status</span>
        <span class="n">currentpid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">inferior_status</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">gdb_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">child</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">old_pid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">delete_ipc_path</span><span class="p">(</span><span class="n">old_pid</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detached from the process with PID:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">old_pid</span><span class="p">))</span></div>



<div class="viewcode-block" id="toggle_attach">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.toggle_attach">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">toggle_attach</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detaches from the current process without ending the season if currently attached. Attaches back if detached</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The new state of the process as a member of typedefs.TOGGLE_ATTACH</span>
<span class="sd">        None: If detaching or attaching fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">currentpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">is_attached</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">gdb_error</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;phase-out&quot;</span><span class="p">)):</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">TOGGLE_ATTACH</span><span class="o">.</span><span class="n">DETACHED</span>
    <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">gdb_error</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;phase-in&quot;</span><span class="p">)):</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">TOGGLE_ATTACH</span><span class="o">.</span><span class="n">ATTACHED</span></div>



<div class="viewcode-block" id="is_attached">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.is_attached">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_attached</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if gdb is attached to the current process</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if attached, False if not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">gdb_error</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;info proc&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="inject_with_advanced_injection">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.inject_with_advanced_injection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">inject_with_advanced_injection</span><span class="p">(</span><span class="n">library_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Injects the given .so file to current process</span>

<span class="sd">    Args:</span>
<span class="sd">        library_path (str): Path to the .so file that&#39;ll be injected</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Result of the injection</span>

<span class="sd">    Note:</span>
<span class="sd">        This function was reserved for linux-inject and since linux-inject is no more(F to pay respects), I&#39;ll leave</span>
<span class="sd">        this function as a template for now</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>



<div class="viewcode-block" id="inject_with_dlopen_call">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.inject_with_dlopen_call">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">inject_with_dlopen_call</span><span class="p">(</span><span class="n">library_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Injects the given .so file to current process</span>
<span class="sd">    This is a variant of the function inject_with_advanced_injection</span>
<span class="sd">    This function won&#39;t break the target process unlike other complex injection methods</span>
<span class="sd">    The downside is it fails if the target doesn&#39;t support dlopen calls or simply doesn&#39;t have the library</span>

<span class="sd">    Args:</span>
<span class="sd">        library_path (str): Path to the .so file that&#39;ll be injected</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Result of the injection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Merge injection functions and rename them to inject_so once advanced injection is implemented</span>
    <span class="n">injectionpath</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">library_path</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">call_function_from_inferior</span><span class="p">(</span><span class="s2">&quot;dlopen(&quot;</span> <span class="o">+</span> <span class="n">injectionpath</span> <span class="o">+</span> <span class="s2">&quot;, 1)&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">new_result</span> <span class="o">=</span> <span class="n">call_function_from_inferior</span><span class="p">(</span><span class="s2">&quot;__libc_dlopen_mode(&quot;</span> <span class="o">+</span> <span class="n">injectionpath</span> <span class="o">+</span> <span class="s2">&quot;, 1)&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">new_result</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">new_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="read_pointer_chain">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.read_pointer_chain">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_pointer_chain</span><span class="p">(</span><span class="n">pointer_request</span><span class="p">:</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">PointerChainRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">PointerChainResult</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads the addresses pointed by this pointer chain</span>

<span class="sd">    Args:</span>
<span class="sd">        pointer_request (typedefs.PointerChainRequest): class containing a base_address and an offsets list</span>

<span class="sd">    Returns:</span>
<span class="sd">        typedefs.PointerChainResult: Class containing every pointer dereference result while walking the chain</span>
<span class="sd">        None: If an error occurs while reading the given pointer chain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pointer_request</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">PointerChainRequest</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Passed non-PointerChainRequest type to read_pointer_chain!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inferior_arch</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_ARCH</span><span class="o">.</span><span class="n">ARCH_32</span><span class="p">:</span>
        <span class="n">value_index</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">INT32</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value_index</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">INT64</span>

    <span class="c1"># Simple addresses first, examine_expression takes much longer time, especially for larger tables</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pointer_request</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">start_address</span> <span class="o">=</span> <span class="n">examine_expression</span><span class="p">(</span><span class="n">pointer_request</span><span class="o">.</span><span class="n">base_address</span><span class="p">)</span><span class="o">.</span><span class="n">address</span>

    <span class="n">pointer_results</span><span class="p">:</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">PointerChainResult</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">PointerChainResult</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">memory_handle</span><span class="p">()</span> <span class="k">as</span> <span class="n">mem_handle</span><span class="p">:</span>
            <span class="c1"># Dereference the first address which is the base or (base + offset)</span>
            <span class="n">deref_address</span> <span class="o">=</span> <span class="n">read_memory</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">value_index</span><span class="p">,</span> <span class="n">mem_handle</span><span class="o">=</span><span class="n">mem_handle</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deref_address</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Simply return None because no point reading further if base is not valid</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">pointer_results</span><span class="o">.</span><span class="n">pointer_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deref_address</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pointer_request</span><span class="o">.</span><span class="n">offsets_list</span><span class="p">):</span>
                <span class="c1"># If deref_address is 0, we found an invalid read in the chain</span>
                <span class="c1"># so we can just keep adding 0 until the end of offsets list</span>
                <span class="k">if</span> <span class="n">deref_address</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pointer_results</span><span class="o">.</span><span class="n">pointer_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">offset_address</span> <span class="o">=</span> <span class="n">deref_address</span> <span class="o">+</span> <span class="n">offset</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pointer_request</span><span class="o">.</span><span class="n">offsets_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># CE derefs every offset except for the last one</span>
                    <span class="n">deref_address</span> <span class="o">=</span> <span class="n">read_memory</span><span class="p">(</span><span class="n">offset_address</span><span class="p">,</span> <span class="n">value_index</span><span class="p">,</span> <span class="n">mem_handle</span><span class="o">=</span><span class="n">mem_handle</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">deref_address</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">deref_address</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">deref_address</span> <span class="o">=</span> <span class="n">offset_address</span>
                <span class="n">pointer_results</span><span class="o">.</span><span class="n">pointer_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deref_address</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">pointer_results</span></div>



<div class="viewcode-block" id="memory_handle">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.memory_handle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">memory_handle</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acquire the handle of the currently attached process</span>

<span class="sd">    Returns:</span>
<span class="sd">        BinaryIO: A file handle that points to the memory file of the current process</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">mem_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="allocate_memory">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.allocate_memory">[docs]</a>
<span class="nd">@execute_with_temporary_interruption</span>
<span class="k">def</span><span class="w"> </span><span class="nf">allocate_memory</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">allocated_memory_chunks</span>
    <span class="k">global</span> <span class="n">allocated_memory_gen_id</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># TODO brkzlr: Maybe error log?</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">allocated_memory_gen_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">allocated_memory_gen_id</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p (void*)malloc(</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">hex_number</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># TODO brkzlr: Allocation failed, maybe log?</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">allocated_memory</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">AllocatedMemory</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">allocated_memory_chunks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">allocated_memory</span>
    <span class="n">page_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sysconf</span><span class="p">(</span><span class="s2">&quot;SC_PAGE_SIZE&quot;</span><span class="p">)</span>
    <span class="n">page_memory_addr</span> <span class="o">=</span> <span class="n">allocated_memory</span><span class="o">.</span><span class="n">address</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">page_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">send_command</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p (int)mprotect(</span><span class="si">{</span><span class="n">page_memory_addr</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">page_size</span><span class="si">}</span><span class="s2">, 7)&quot;</span><span class="p">)</span>  <span class="c1"># PROT_READ | PROT_WRITE | PROT_EXEC = 7</span>
    <span class="k">return</span> <span class="n">allocated_memory</span><span class="o">.</span><span class="n">address</span></div>



<div class="viewcode-block" id="free_memory">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.free_memory">[docs]</a>
<span class="nd">@execute_with_temporary_interruption</span>
<span class="k">def</span><span class="w"> </span><span class="nf">free_memory</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">allocated_memory_chunks</span>
    <span class="k">if</span> <span class="nb">str</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">str</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="c1"># TODO brkzlr: Maybe error log?</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">allocated_memory_chunks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">address</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># TODO brkzlr: log wrong key</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># This shit will crash the process if you call it on invalid or already freed memory.</span>
    <span class="n">send_command</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p (void)free(</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">allocated_memory_chunks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="read_memory">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.read_memory">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_memory</span><span class="p">(</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">value_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">zero_terminate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">value_repr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_REPR</span><span class="o">.</span><span class="n">UNSIGNED</span><span class="p">,</span>
    <span class="n">endian</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ENDIANNESS</span><span class="o">.</span><span class="n">HOST</span><span class="p">,</span>
    <span class="n">mem_handle</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads value from the given address</span>

<span class="sd">    Args:</span>
<span class="sd">        address (str, int): Can be a hex string or an integer.</span>
<span class="sd">        value_index (int): Determines the type of data read. Can be a member of typedefs.VALUE_INDEX</span>
<span class="sd">        length (int): Length of the data that&#39;ll be read. Must be greater than 0. Only used when the value_index is</span>
<span class="sd">        STRING or AOB. Ignored otherwise</span>
<span class="sd">        zero_terminate (bool): If True, data will be split when a null character has been read. Only used when</span>
<span class="sd">        value_index is STRING. Ignored otherwise</span>
<span class="sd">        value_repr (int): Can be a member of typedefs.VALUE_REPR. Only usable with integer types</span>
<span class="sd">        endian (int): Can be a member of typedefs.ENDIANNESS</span>
<span class="sd">        mem_handle (io.BufferedReader, None): A file handle that points to the memory file of the current process</span>
<span class="sd">        This parameter is used for optimization, See memory_handle</span>
<span class="sd">        Don&#39;t forget to close the handle after you&#39;re done if you use this parameter manually</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: If the value_index is STRING or AOB, also when value_repr is HEX</span>
<span class="sd">        float: If the value_index is FLOAT32 or FLOAT64</span>
<span class="sd">        int: If the value_index is anything else</span>
<span class="sd">        None: If an error occurs while reading the given address</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_index</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># print(str(value_index) + &quot; is not a valid value index&quot;)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># print(str(address) + &quot; is not a valid address&quot;)</span>
            <span class="k">return</span>
    <span class="n">packed_data</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">index_to_valuetype_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">is_string</span><span class="p">(</span><span class="n">value_index</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># print(str(length) + &quot; is not a valid length&quot;)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(&quot;length must be greater than 0&quot;)</span>
            <span class="k">return</span>
        <span class="n">expected_length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">string_index_to_multiplier_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">value_index</span> <span class="ow">is</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">AOB</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">expected_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># print(str(length) + &quot; is not a valid length&quot;)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(&quot;length must be greater than 0&quot;)</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expected_length</span> <span class="o">=</span> <span class="n">packed_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="n">packed_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mem_handle</span><span class="p">:</span>
            <span class="n">mem_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mem_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">mem_handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">data_read</span> <span class="o">=</span> <span class="n">mem_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">expected_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">endian</span> <span class="o">!=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ENDIANNESS</span><span class="o">.</span><span class="n">HOST</span> <span class="ow">and</span> <span class="n">system_endianness</span> <span class="o">!=</span> <span class="n">endian</span><span class="p">:</span>
            <span class="n">data_read</span> <span class="o">=</span> <span class="n">data_read</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="c1"># TODO (read/write error output)</span>
        <span class="c1"># Disabled read error printing. If needed, find a way to implement error logging with this function</span>
        <span class="c1"># I&#39;ve initially thought about enabling it on demand via a parameter but this function already has too many</span>
        <span class="c1"># Maybe creating a function that toggles logging on and off? Other functions could use it too</span>
        <span class="c1"># print(&quot;Can&#39;t access the memory at address &quot; + hex(address) + &quot; or offset &quot; + hex(address + expected_length))</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">is_string</span><span class="p">(</span><span class="n">value_index</span><span class="p">):</span>
        <span class="n">encoding</span><span class="p">,</span> <span class="n">option</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">string_index_to_encoding_dict</span><span class="p">[</span><span class="n">value_index</span><span class="p">]</span>
        <span class="n">returned_string</span> <span class="o">=</span> <span class="n">data_read</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zero_terminate</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">returned_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">returned_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">returned_string</span> <span class="o">=</span> <span class="n">returned_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">returned_string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">value_index</span> <span class="ow">is</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">AOB</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;02x&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data_read</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_integer</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">is_integer</span><span class="p">(</span><span class="n">value_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_integer</span> <span class="ow">and</span> <span class="n">value_repr</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_REPR</span><span class="o">.</span><span class="n">SIGNED</span><span class="p">:</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">data_read</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">is_integer</span> <span class="ow">and</span> <span class="n">value_repr</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_REPR</span><span class="o">.</span><span class="n">HEX</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="write_memory">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.write_memory">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_memory</span><span class="p">(</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">value_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">zero_terminate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">endian</span><span class="o">=</span><span class="n">typedefs</span><span class="o">.</span><span class="n">ENDIANNESS</span><span class="o">.</span><span class="n">HOST</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets the given value to the given address</span>

<span class="sd">    If any errors occurs while setting value to the according address, it&#39;ll be ignored but the information about</span>
<span class="sd">    error will be printed to the terminal.</span>

<span class="sd">    Args:</span>
<span class="sd">        address (str, int): Can be a hex string or an integer</span>
<span class="sd">        value_index (int): Can be a member of typedefs.VALUE_INDEX</span>
<span class="sd">        value (str, int, float, list): The value that&#39;ll be written to the given address</span>
<span class="sd">        zero_terminate (bool): If True, appends a null byte to the value. Only used when value_index is STRING</span>
<span class="sd">        endian (int): Can be a member of typedefs.ENDIANNESS</span>

<span class="sd">    Notes:</span>
<span class="sd">        TODO: Implement a mem_handle parameter for optimization, check read_memory for an example</span>
<span class="sd">        If a file handle fails to write to an address, it becomes unusable</span>
<span class="sd">        You have to reopen the file to continue writing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># print(str(address) + &quot; is not a valid address&quot;)</span>
            <span class="k">return</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">write_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">write_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">write_data</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">encoding</span><span class="p">,</span> <span class="n">option</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">string_index_to_encoding_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_index</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value_index</span> <span class="ow">is</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">AOB</span><span class="p">:</span>
            <span class="n">write_data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">write_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">index_to_struct_pack_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">write_data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">write_data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">write_data</span> <span class="o">=</span> <span class="n">write_data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zero_terminate</span><span class="p">:</span>
            <span class="n">write_data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">endian</span> <span class="o">!=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">ENDIANNESS</span><span class="o">.</span><span class="n">HOST</span> <span class="ow">and</span> <span class="n">system_endianness</span> <span class="o">!=</span> <span class="n">endian</span><span class="p">:</span>
        <span class="n">write_data</span> <span class="o">=</span> <span class="n">write_data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">FILE</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mem_file</span><span class="p">,</span> <span class="s2">&quot;rb+&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_data</span><span class="p">)</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="c1"># Refer to TODO (read/write error output)</span>
        <span class="c1"># print(&quot;Can&#39;t access the memory at address &quot; + hex(address) + &quot; or offset &quot; + hex(address + len(write_data)))</span>
        <span class="k">return</span></div>



<div class="viewcode-block" id="disassemble">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.disassemble">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">disassemble</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">offset_or_address</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Disassembles the address evaluated by the given expression</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        offset_or_address (str): If you pass this parameter as an offset, you should add &quot;+&quot; in front of it</span>
<span class="sd">        (e.g &quot;+42&quot; or &quot;+0x42&quot;). If you pass this parameter as an hex address, the address range between the expression</span>
<span class="sd">        and the secondary address is disassembled</span>
<span class="sd">        If the second parameter is an address, it always should be bigger than the first address</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of str values in this format--&gt;[(address1, bytes1, opcodes1), (address2, ...), ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;disas /r &quot;</span> <span class="o">+</span> <span class="n">expression</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">offset_or_address</span><span class="p">)</span>
    <span class="n">disas_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">disassemble_output</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">disas_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">disas_data</span></div>



<div class="viewcode-block" id="convert_to_hex">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.convert_to_hex">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_hex</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts numeric values in the expression into their hex equivalents</span>
<span class="sd">    Respects edge cases like indexed maps and keeps indices as decimals</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Converted str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO (lldb): We&#39;ll most likely write our own expression parser once we switch to lldb</span>
    <span class="c1"># Merge this function with examine_expression and gdbutils.examine_expression once that happens</span>
    <span class="k">return</span> <span class="n">regexes</span><span class="o">.</span><span class="n">expression_with_hex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s2">&quot;0x&quot;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">examine_expression</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">symbol</span> <span class="k">else</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">expression</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="examine_expression">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.examine_expression">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">examine_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluates the given expression and returns evaluated value, address and symbol</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        typedefs.tuple_examine_expression: Evaluated value, address and symbol in a tuple</span>
<span class="sd">        Any erroneous field will be returned as None instead of str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">currentpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">tuple_examine_expression</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span>
        <span class="s2">&quot;pince-examine-expressions&quot;</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="p">[</span><span class="n">expression</span><span class="p">],</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>



<div class="viewcode-block" id="examine_expressions">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.examine_expressions">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">examine_expressions</span><span class="p">(</span><span class="n">expression_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimized version of examine_expression for multiple inputs</span>

<span class="sd">    Args:</span>
<span class="sd">        expression_list (list): List of gdb expressions as str</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of typedefs.tuple_examine_expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">expression_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">currentpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">typedefs</span><span class="o">.</span><span class="n">tuple_examine_expression</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expression_list</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span>
        <span class="s2">&quot;pince-examine-expressions&quot;</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="n">expression_list</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="parse_and_eval">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.parse_and_eval">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_and_eval</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">cast</span><span class="o">=</span><span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calls gdb.parse_and_eval with the given expression and returns the value after casting with the given type</span>
<span class="sd">    Use examine_expression if your data can be expressed as an address or a symbol, use this function otherwise</span>
<span class="sd">    Unlike examine_expression, this function can read data that has void type or multiple type representations</span>
<span class="sd">    For instance:</span>

<span class="sd">    - $eflags has both str and int reprs</span>
<span class="sd">    - $_siginfo is a struct with many fields</span>
<span class="sd">    - x64 register convenience vars such as $rax are void if the process is x86</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        cast (type): Evaluated value will be cast to this type in gdb</span>

<span class="sd">    Returns:</span>
<span class="sd">        cast: Self-explanatory</span>
<span class="sd">        None: If casting fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span>
        <span class="s2">&quot;pince-parse-and-eval&quot;</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">cast</span><span class="p">),</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="get_thread_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_thread_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_thread_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Invokes &quot;info threads&quot; command and returns the line corresponding to the current thread</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Current thread information</span>
<span class="sd">        None: If the output doesn&#39;t fit the regex</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">thread_info</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;info threads&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">regexes</span><span class="o">.</span><span class="n">thread_info</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">thread_info</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span></div>



<div class="viewcode-block" id="find_closest_instruction_address">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.find_closest_instruction_address">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_closest_instruction_address</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">instruction_location</span><span class="o">=</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">instruction_count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds address of the closest instruction next to the given address, assuming that the given address is valid</span>

<span class="sd">    Args:</span>
<span class="sd">        address (str): Hex address or any gdb expression that can be used in disas command</span>
<span class="sd">        instruction_location (str): If it&#39;s &quot;next&quot;, instructions coming after the address is searched</span>
<span class="sd">        If it&#39;s &quot;previous&quot;, the instructions coming before the address is searched instead</span>
<span class="sd">        instruction_count (int): Number of the instructions that&#39;ll be looked for</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The address found as hex string. If starting/ending of a valid memory range is reached, starting/ending</span>
<span class="sd">        address is returned instead as hex string.</span>

<span class="sd">    Note:</span>
<span class="sd">        From gdb version 7.12 and onwards, inputting negative numbers in x command are supported(x/-3i for instance)</span>
<span class="sd">        So, modifying this function according to the changes in 7.12 may speed up things a little bit but also breaks</span>
<span class="sd">        the backwards compatibility. The speed gain is not much of a big deal compared to backwards compatibility, so</span>
<span class="sd">        I&#39;m not changing this function for now</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">instruction_location</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="s2">&quot;previous&quot;</span><span class="p">],</span> <span class="s2">&quot;invalid instruction_location&quot;</span>
    <span class="k">if</span> <span class="n">instruction_location</span> <span class="o">==</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instruction_count</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">disas_data</span> <span class="o">=</span> <span class="n">disassemble</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">address</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instruction_count</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">disas_data</span> <span class="o">=</span> <span class="n">disassemble</span><span class="p">(</span><span class="n">address</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">disas_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">instruction_location</span> <span class="o">!=</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span>
            <span class="n">start_address</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_region_info</span><span class="p">(</span><span class="n">currentpid</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="n">disas_data</span> <span class="o">=</span> <span class="n">disassemble</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instruction_location</span> <span class="o">==</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">extract_address</span><span class="p">(</span><span class="n">disas_data</span><span class="p">[</span><span class="n">instruction_count</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_region_info</span><span class="p">(</span><span class="n">currentpid</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">extract_address</span><span class="p">(</span><span class="n">disas_data</span><span class="p">[</span><span class="o">-</span><span class="n">instruction_count</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">start_address</span>
            <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_region_info</span><span class="p">(</span><span class="n">currentpid</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_address_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_address_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_address_info</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the gdb command &quot;info symbol&quot; for given expression and returns the result of it</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The result of the command &quot;info symbol&quot; for given expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;info symbol &quot;</span> <span class="o">+</span> <span class="n">expression</span><span class="p">,</span> <span class="n">cli_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_symbol_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_symbol_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_symbol_info</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the gdb command &quot;info address&quot; for given expression and returns the result of it</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The result of the command &quot;info address&quot; for given expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;info address &quot;</span> <span class="o">+</span> <span class="n">expression</span><span class="p">,</span> <span class="n">cli_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="search_functions">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.search_functions">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">search_functions</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the gdb command &quot;info functions&quot; for given expression and returns the result of it</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        case_sensitive (bool): If True, search will be case sensitive</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of str--&gt;[(address1, symbol1), (address2, symbol2), ...]</span>
<span class="sd">            address will be None if the corresponding symbol is in defined category</span>

<span class="sd">    Todo:</span>
<span class="sd">        GDB-MI wiki points out to the command -symbol-list-functions but apparently it isn&#39;t implemented yet</span>
<span class="sd">        If the feature below gets implemented, use it instead</span>
<span class="sd">        https://sourceware.org/bugzilla/show_bug.cgi?id=23796</span>

<span class="sd">        Add ability to show addresses of defined symbols when it gets implemented by gdb</span>
<span class="sd">        Please don&#39;t try to write a symbol parser for every single language out there, it&#39;s an overkill</span>
<span class="sd">        https://sourceware.org/bugzilla/show_bug.cgi?id=23899</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span>
        <span class="s2">&quot;pince-search-functions&quot;</span><span class="p">,</span>
        <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">file_contents_send</span><span class="o">=</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">),</span>
        <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="get_inferior_pid">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_inferior_pid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_inferior_pid</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get pid of the current inferior</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: pid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;info inferior&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">regexes</span><span class="o">.</span><span class="n">inferior_pid</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_inferior_arch">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_inferior_arch">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_inferior_arch</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the architecture of the current inferior</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: A member of typedefs.INFERIOR_ARCH</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parse_and_eval</span><span class="p">(</span><span class="s2">&quot;$rax&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;void&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_ARCH</span><span class="o">.</span><span class="n">ARCH_32</span>
    <span class="k">return</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_ARCH</span><span class="o">.</span><span class="n">ARCH_64</span></div>



<div class="viewcode-block" id="read_registers">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.read_registers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_registers</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the current registers</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dict that holds general, flag and segment registers. Check typedefs.REGISTERS for the full list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-read-registers&quot;</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="read_float_registers">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.read_float_registers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_float_registers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the current floating point registers</span>

<span class="sd">    Returns:</span>
<span class="sd">        OrderedDict[str, str]: A dict that holds floating point registers. Check typedefs.REGISTERS.FLOAT for the full list</span>

<span class="sd">    Note:</span>
<span class="sd">        Returned xmm values are based on xmm.v4_float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-read-float-registers&quot;</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="set_convenience_variable">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.set_convenience_variable">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_convenience_variable</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets given convenience variable to given value</span>
<span class="sd">    Can be also used for modifying registers directly</span>

<span class="sd">    Args:</span>
<span class="sd">        variable (str): Any gdb convenience variable(with &quot;$&quot; character removed)</span>
<span class="sd">        value (str): Anything</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;set $&quot;</span> <span class="o">+</span> <span class="n">variable</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="set_register_flag">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.set_register_flag">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_register_flag</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets given register flag to given value</span>

<span class="sd">    Args:</span>
<span class="sd">        flag (str): A member of typedefs.REGISTERS.FLAG</span>
<span class="sd">        value (Union[int,str]): 0 or 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">registers</span> <span class="o">=</span> <span class="n">read_registers</span><span class="p">()</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">registers</span><span class="p">[</span><span class="n">flag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="s2">&quot; isn&#39;t valid value. It can be only 0 or 1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">REGISTERS</span><span class="o">.</span><span class="n">FLAG</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="s2">&quot; isn&#39;t a valid flag, must be a member of typedefs.REGISTERS.FLAG&quot;</span><span class="p">)</span>
    <span class="n">eflags_hex_value</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span>
            <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;of&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;if&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;tf&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;sf&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;zf&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;0&quot;</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;af&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;0&quot;</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;pf&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;0&quot;</span>
            <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">],</span>
            <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">set_convenience_variable</span><span class="p">(</span><span class="s2">&quot;eflags&quot;</span><span class="p">,</span> <span class="n">eflags_hex_value</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_stacktrace_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_stacktrace_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_stacktrace_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns information about current stacktrace</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of str values in this format--&gt;[[return_address_info1,frame_address_info1],[info2, ...], ...]</span>

<span class="sd">        return_address_info looks like this--&gt;Return address of frame+symbol--&gt;0x40c431 &lt;_start&gt;</span>
<span class="sd">        frame_address_info looks like this--&gt;Beginning of frame+distance from stack pointer--&gt;0x7ffe1e989a40(rsp+0x100)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-get-stack-trace-info&quot;</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_stack_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_stack_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_stack_info</span><span class="p">(</span><span class="n">from_base_pointer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns information about current stack</span>
<span class="sd">    Also can view stack from EBP or RBP register</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of str values in this format--‚ñº</span>
<span class="sd">        [[stack_pointer_info1,hex_value1,pointer_info1],[stack_pointer_info2, ...], ...]</span>

<span class="sd">        stack_pointer_info looks like this--&gt;Hex address+distance from stack pointer--&gt;0x7ffd0d232f88(rsp+0xff8)</span>
<span class="sd">        hex_value looks like this--&gt;Value hold by corresponding address--&gt;0x1bfda20</span>
<span class="sd">        pointer_info shows the value hold by hex_value address. It looks like this--‚ñº</span>
<span class="sd">        if points to a string--&gt;(str)Some String</span>
<span class="sd">        if points to a symbol--&gt;(ptr)&lt;function_name&gt;</span>
<span class="sd">        pointer_info becomes a null string if pointer isn&#39;t valid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">from_base_pointer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-get-stack-info from-base-pointer&quot;</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-get-stack-info&quot;</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_stack_frame_return_addresses">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_stack_frame_return_addresses">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_stack_frame_return_addresses</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns return addresses of stack frames</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of str values in this format--&gt;[return_address_info1,return_address_info2, ...]</span>

<span class="sd">        return_address_info looks like this--&gt;Return address of frame+symbol--&gt;0x40c431 &lt;_start&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-get-frame-return-addresses&quot;</span><span class="p">,</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_stack_frame_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_stack_frame_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_stack_frame_info</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns information about stack by the given index</span>

<span class="sd">    Args:</span>
<span class="sd">        index (int,str): Index of the frame</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Information that looks like this::</span>

<span class="sd">        Stack level 0, frame at 0x7ffc5f87f6a0:</span>
<span class="sd">            rip = 0x7fd1d639412d in poll (../sysdeps/unix/syscall-template.S:81); saved rip = 0x7fd1d27fcfe4</span>
<span class="sd">            called by frame at 0x7ffc5f87f700</span>
<span class="sd">            source language asm.</span>
<span class="sd">            Arglist at 0x7ffc5f87f688, args:</span>
<span class="sd">            Locals at 0x7ffc5f87f688, Previous frame&#39;s sp is 0x7ffc5f87f6a0</span>
<span class="sd">            Saved registers:</span>
<span class="sd">                rip at 0x7ffc5f87f698</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-get-frame-info&quot;</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="hex_dump">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.hex_dump">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hex_dump</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns hex dump of range (address to address+offset)</span>

<span class="sd">    Args:</span>
<span class="sd">        address (int): Self-explanatory</span>
<span class="sd">        offset (int): The range that&#39;ll be read</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of strings read as str. If an error occurs while reading a memory cell, that cell is returned as &quot;??&quot;</span>
<span class="sd">        An empty list is returned if an error occurs</span>

<span class="sd">    Examples:</span>
<span class="sd">        returned list--&gt;[&quot;??&quot;,&quot;??&quot;,&quot;??&quot;,&quot;7f&quot;,&quot;43&quot;,&quot;67&quot;,&quot;40&quot;,&quot;??&quot;,&quot;??, ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hex_byte_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mem_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FILE</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">FILE</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offset</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">current_item</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;02x&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">FILE</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">current_item</span> <span class="o">=</span> <span class="s2">&quot;??&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">FILE</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_CUR</span><span class="p">)</span>  <span class="c1"># Necessary since read() failed to execute</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="n">hex_byte_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">upper_hex</span><span class="p">(</span><span class="n">current_item</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">hex_byte_list</span></div>



<div class="viewcode-block" id="get_modified_instructions">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_modified_instructions">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_modified_instructions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns currently modified instructions</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary where the key is the start address of instruction and value is the aob before modifying</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">modified_instructions_dict</span>
    <span class="k">return</span> <span class="n">modified_instructions_dict</span></div>



<div class="viewcode-block" id="nop_instruction">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.nop_instruction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">nop_instruction</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">length_of_instr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replaces an instruction&#39;s opcodes with NOPs</span>

<span class="sd">    Args:</span>
<span class="sd">        start_address (int): Self-explanatory</span>
<span class="sd">        length_of_instr (int): Length of the instruction that&#39;ll be NOP&#39;ed</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_aob</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hex_dump</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">length_of_instr</span><span class="p">))</span>
    <span class="k">global</span> <span class="n">modified_instructions_dict</span>
    <span class="k">if</span> <span class="n">start_address</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modified_instructions_dict</span><span class="p">:</span>
        <span class="n">modified_instructions_dict</span><span class="p">[</span><span class="n">start_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_aob</span>

    <span class="n">nop_aob</span> <span class="o">=</span> <span class="s2">&quot;90 &quot;</span> <span class="o">*</span> <span class="n">length_of_instr</span>
    <span class="n">write_memory</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">AOB</span><span class="p">,</span> <span class="n">nop_aob</span><span class="p">)</span></div>



<div class="viewcode-block" id="modify_instruction">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.modify_instruction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">modify_instruction</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">array_of_bytes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replaces an instruction&#39;s opcodes with a new AOB</span>

<span class="sd">    Args:</span>
<span class="sd">        start_address (int): Self-explanatory</span>
<span class="sd">        array_of_bytes (str): String that contains the replacement bytes of the instruction</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_of_bytes</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">old_aob</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hex_dump</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>

    <span class="k">global</span> <span class="n">modified_instructions_dict</span>
    <span class="k">if</span> <span class="n">start_address</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modified_instructions_dict</span><span class="p">:</span>
        <span class="n">modified_instructions_dict</span><span class="p">[</span><span class="n">start_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_aob</span>
    <span class="n">write_memory</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">AOB</span><span class="p">,</span> <span class="n">array_of_bytes</span><span class="p">)</span></div>



<div class="viewcode-block" id="restore_instruction">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.restore_instruction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">restore_instruction</span><span class="p">(</span><span class="n">start_address</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Restores a modified instruction to it&#39;s original opcodes</span>

<span class="sd">    Args:</span>
<span class="sd">        start_address (int): Self-explanatory</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">modified_instructions_dict</span>
    <span class="n">array_of_bytes</span> <span class="o">=</span> <span class="n">modified_instructions_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">start_address</span><span class="p">)</span>
    <span class="n">write_memory</span><span class="p">(</span><span class="n">start_address</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">AOB</span><span class="p">,</span> <span class="n">array_of_bytes</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_breakpoint_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_breakpoint_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_breakpoint_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">typedefs</span><span class="o">.</span><span class="n">tuple_breakpoint_info</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns current breakpoint/watchpoint list</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of typedefs.tuple_breakpoint_info where;</span>
<span class="sd">            number is the gdb breakpoint number</span>
<span class="sd">            breakpoint_type is the breakpoint type</span>
<span class="sd">            disp shows what will be done after breakpoint hits</span>
<span class="sd">            enabled shows if the breakpoint enabled or disabled</span>
<span class="sd">            address is the address of breakpoint</span>
<span class="sd">            size is the size of breakpoint</span>
<span class="sd">            on_hit is the action that&#39;ll happen when the breakpoint is reached</span>
<span class="sd">            hit_count shows how many times the breakpoint has been hit</span>
<span class="sd">            enable_count shows how many times the breakpoint will get hit before it gets disabled</span>
<span class="sd">            condition is the condition of breakpoint</span>

<span class="sd">            size--&gt;int</span>
<span class="sd">            everything else--&gt;str</span>

<span class="sd">    Note:</span>
<span class="sd">        GDB&#39;s python API can&#39;t detect hardware breakpoints, that&#39;s why we are using parser for this job</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">returned_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">multiple_break_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">raw_info</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;-break-list&quot;</span><span class="p">)</span>
    <span class="c1"># Temporary fix for https://sourceware.org/bugzilla/show_bug.cgi?id=9659</span>
    <span class="c1"># TODO:Delete this line when gdb or pygdbmi fixes the problem</span>
    <span class="n">raw_info</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;script={(.*?)}&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;script=[\g&lt;1&gt;]&quot;</span><span class="p">,</span> <span class="n">raw_info</span><span class="p">)</span>  <span class="c1"># Please refer to issue #53</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_response</span><span class="p">(</span><span class="n">raw_info</span><span class="p">)[</span><span class="s2">&quot;payload&quot;</span><span class="p">][</span><span class="s2">&quot;BreakpointTable&quot;</span><span class="p">][</span><span class="s2">&quot;body&quot;</span><span class="p">]:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">number</span><span class="p">,</span> <span class="n">breakpoint_type</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">hit_count</span><span class="p">,</span> <span class="n">enable_count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;disp&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;addr&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;what&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;cond&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;enable&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">address</span> <span class="o">==</span> <span class="s2">&quot;&lt;MULTIPLE&gt;&quot;</span><span class="p">:</span>
            <span class="n">multiple_break_data</span><span class="p">[</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">breakpoint_type</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">hit_count</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">breakpoint_type</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">breakpoint_type</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">hit_count</span> <span class="o">=</span> <span class="n">multiple_break_data</span><span class="p">[</span><span class="n">number</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">what</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">extract_address</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span><span class="p">:</span>
                <span class="n">address</span> <span class="o">=</span> <span class="n">examine_expression</span><span class="p">(</span><span class="n">what</span><span class="p">)</span><span class="o">.</span><span class="n">address</span>
        <span class="n">on_hit_dict_value</span> <span class="o">=</span> <span class="n">breakpoint_on_hit_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_ON_HIT</span><span class="o">.</span><span class="n">BREAK</span><span class="p">)</span>
        <span class="n">on_hit</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">on_hit_to_text_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">on_hit_dict_value</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">breakpoint_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;breakpoint&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_size</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">breakpoint_size</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">possible_size</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">possible_size</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">returned_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">typedefs</span><span class="o">.</span><span class="n">tuple_breakpoint_info</span><span class="p">(</span>
                <span class="n">number</span><span class="p">,</span> <span class="n">breakpoint_type</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">on_hit</span><span class="p">,</span> <span class="n">hit_count</span><span class="p">,</span> <span class="n">enable_count</span><span class="p">,</span> <span class="n">condition</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">returned_list</span></div>



<div class="viewcode-block" id="get_breakpoints_in_range">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_breakpoints_in_range">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_breakpoints_in_range</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">typedefs</span><span class="o">.</span><span class="n">tuple_breakpoint_info</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if given address exists in breakpoint list</span>

<span class="sd">    Args:</span>
<span class="sd">        address (str,int): Start address of the range, hex address or an int</span>
<span class="sd">        length (int): If this parameter is bigger than 1, the range between address and address+length-1 will be</span>
<span class="sd">        checked instead of just the address itself</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of typedefs.tuple_breakpoint_info, info of the existing breakpoints for given address range</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">breakpoint_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">max_address</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">address</span> <span class="o">+</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">min_address</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">address</span> <span class="o">+</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">breakpoint_info</span> <span class="o">=</span> <span class="n">get_breakpoint_info</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">breakpoint_info</span><span class="p">:</span>
        <span class="n">breakpoint_address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_address</span> <span class="o">&lt;</span> <span class="n">breakpoint_address</span> <span class="ow">or</span> <span class="n">min_address</span> <span class="o">&gt;</span> <span class="n">breakpoint_address</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">breakpoint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">breakpoint_list</span></div>



<div class="viewcode-block" id="hardware_breakpoint_available">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.hardware_breakpoint_available">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hardware_breakpoint_available</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if there is an available hardware breakpoint slot</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if there is at least one available slot, False if not</span>

<span class="sd">    Todo:</span>
<span class="sd">        Check debug registers to determine hardware breakpoint state rather than relying on gdb output because inferior</span>
<span class="sd">        might modify its own debug registers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">breakpoint_info</span> <span class="o">=</span> <span class="n">get_breakpoint_info</span><span class="p">()</span>
    <span class="n">hw_bp_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">breakpoint_info</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">hw_breakpoint_count</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">breakpoint_type</span><span class="p">):</span>
            <span class="n">hw_bp_total</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Maximum number of hardware breakpoints is limited to 4 in x86 architecture</span>
    <span class="k">return</span> <span class="n">hw_bp_total</span> <span class="o">&lt;</span> <span class="mi">4</span></div>



<div class="viewcode-block" id="add_breakpoint">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.add_breakpoint">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_breakpoint</span><span class="p">(</span>
    <span class="n">expression</span><span class="p">,</span> <span class="n">breakpoint_type</span><span class="o">=</span><span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_TYPE</span><span class="o">.</span><span class="n">HARDWARE</span><span class="p">,</span> <span class="n">on_hit</span><span class="o">=</span><span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_ON_HIT</span><span class="o">.</span><span class="n">BREAK</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds a breakpoint at the address evaluated by the given expression. Uses a software breakpoint if all hardware</span>
<span class="sd">    breakpoint slots are being used</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        breakpoint_type (int): Can be a member of typedefs.BREAKPOINT_TYPE</span>
<span class="sd">        on_hit (int): Can be a member of typedefs.BREAKPOINT_ON_HIT</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Number of the breakpoint set</span>
<span class="sd">        None: If setting breakpoint fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">str_address</span> <span class="o">=</span> <span class="n">examine_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">address</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">str_address</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;expression for breakpoint is not valid&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">get_breakpoints_in_range</span><span class="p">(</span><span class="n">str_address</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;breakpoint/watchpoint for address &quot;</span> <span class="o">+</span> <span class="n">str_address</span> <span class="o">+</span> <span class="s2">&quot; is already set&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">breakpoint_type</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_TYPE</span><span class="o">.</span><span class="n">HARDWARE</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hardware_breakpoint_available</span><span class="p">():</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;hbreak *&quot;</span> <span class="o">+</span> <span class="n">str_address</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All hardware breakpoint slots are being used, using a software breakpoint instead&quot;</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;break *&quot;</span> <span class="o">+</span> <span class="n">str_address</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">breakpoint_type</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_TYPE</span><span class="o">.</span><span class="n">SOFTWARE</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;break *&quot;</span> <span class="o">+</span> <span class="n">str_address</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">breakpoint_created</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">breakpoint_on_hit_dict</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">breakpoint_number</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">breakpoint_on_hit_dict</span><span class="p">[</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">on_hit</span>
        <span class="k">return</span> <span class="n">number</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>



<div class="viewcode-block" id="add_watchpoint">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.add_watchpoint">[docs]</a>
<span class="nd">@execute_with_temporary_interruption</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_watchpoint</span><span class="p">(</span>
    <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">watchpoint_type</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">WATCHPOINT_TYPE</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span>
    <span class="n">on_hit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_ON_HIT</span><span class="o">.</span><span class="n">BREAK</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds a watchpoint at the address evaluated by the given expression</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        length (int): Length of the watchpoint</span>
<span class="sd">        watchpoint_type (int): Can be a member of typedefs.WATCHPOINT_TYPE</span>
<span class="sd">        on_hit (int): Can be a member of typedefs.BREAKPOINT_ON_HIT</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Numbers of the successfully set breakpoints as strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">str_address</span> <span class="o">=</span> <span class="n">examine_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">address</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">str_address</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;expression for watchpoint is not valid&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">watchpoint_type</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">WATCHPOINT_TYPE</span><span class="o">.</span><span class="n">WRITE_ONLY</span><span class="p">:</span>
        <span class="n">watch_command</span> <span class="o">=</span> <span class="s2">&quot;watch&quot;</span>
    <span class="k">elif</span> <span class="n">watchpoint_type</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">WATCHPOINT_TYPE</span><span class="o">.</span><span class="n">READ_ONLY</span><span class="p">:</span>
        <span class="n">watch_command</span> <span class="o">=</span> <span class="s2">&quot;rwatch&quot;</span>
    <span class="k">elif</span> <span class="n">watchpoint_type</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">WATCHPOINT_TYPE</span><span class="o">.</span><span class="n">BOTH</span><span class="p">:</span>
        <span class="n">watch_command</span> <span class="o">=</span> <span class="s2">&quot;awatch&quot;</span>
    <span class="n">remaining_length</span> <span class="o">=</span> <span class="n">length</span>
    <span class="n">breakpoints_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arch</span> <span class="o">=</span> <span class="n">get_inferior_arch</span><span class="p">()</span>
    <span class="n">str_address_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str_address</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">breakpoint_addresses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">arch</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">INFERIOR_ARCH</span><span class="o">.</span><span class="n">ARCH_64</span><span class="p">:</span>
        <span class="n">max_length</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_length</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">while</span> <span class="n">remaining_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">remaining_length</span> <span class="o">&gt;=</span> <span class="n">max_length</span><span class="p">:</span>
            <span class="n">breakpoint_length</span> <span class="o">=</span> <span class="n">max_length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">breakpoint_length</span> <span class="o">=</span> <span class="n">remaining_length</span>
        <span class="k">if</span> <span class="n">get_breakpoints_in_range</span><span class="p">(</span><span class="n">str_address_int</span><span class="p">,</span> <span class="n">breakpoint_length</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;breakpoint/watchpoint for address &quot;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">str_address_int</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is already set. Bailing out...&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hardware_breakpoint_available</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All hardware breakpoint slots are being used, unable to set a new watchpoint. Bailing out...&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">watch_command</span><span class="si">}</span><span class="s2"> * (char[</span><span class="si">{</span><span class="n">breakpoint_length</span><span class="si">}</span><span class="s2">] *) </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">str_address_int</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">execute_func_temporary_interruption</span><span class="p">(</span><span class="n">send_command</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">breakpoint_created</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
            <span class="n">breakpoint_addresses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">str_address_int</span><span class="p">,</span> <span class="n">breakpoint_length</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to create a watchpoint at address &quot;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">str_address_int</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;. Bailing out...&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">breakpoint_number</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">breakpoint_number</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">breakpoints_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">breakpoint_number</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">breakpoint_on_hit_dict</span>
        <span class="n">breakpoint_on_hit_dict</span><span class="p">[</span><span class="n">breakpoint_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">on_hit</span>
        <span class="n">remaining_length</span> <span class="o">-=</span> <span class="n">max_length</span>
        <span class="n">str_address_int</span> <span class="o">+=</span> <span class="n">max_length</span>
    <span class="k">global</span> <span class="n">chained_breakpoints</span>
    <span class="n">chained_breakpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">breakpoint_addresses</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">breakpoints_set</span></div>



<div class="viewcode-block" id="modify_breakpoint">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.modify_breakpoint">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">modify_breakpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">modify_what</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds a condition to the breakpoint at the address evaluated by the given expression</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        modify_what (int): Can be a member of typedefs.BREAKPOINT_MODIFY_TYPES</span>
<span class="sd">        This function modifies condition of the breakpoint if CONDITION, enables the breakpoint if ENABLE, disables the</span>
<span class="sd">        breakpoint if DISABLE, enables once then disables after hit if ENABLE_ONCE, enables for specified count then</span>
<span class="sd">        disables after the count is reached if ENABLE_COUNT, enables once then deletes the breakpoint if ENABLE_DELETE</span>
<span class="sd">        condition (str): Any gdb condition expression. This parameter is only used if modify_what passed as CONDITION</span>
<span class="sd">        count (int): Only used if modify_what passed as ENABLE_COUNT</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the condition has been set successfully, False otherwise</span>

<span class="sd">    Examples:</span>
<span class="sd">        modify_what--&gt;typedefs.BREAKPOINT_MODIFY_TYPES.CONDITION</span>
<span class="sd">        condition--&gt;$eax==0x523</span>
<span class="sd">        condition--&gt;$rax&gt;0 &amp;&amp; ($rbp&lt;0 || $rsp==0)</span>
<span class="sd">        condition--&gt;printf($r10)==3</span>

<span class="sd">        modify_what--&gt;typedefs.BREAKPOINT_MODIFY_TYPES.ENABLE_COUNT</span>
<span class="sd">        count--&gt;10</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">str_address</span> <span class="o">=</span> <span class="n">examine_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">address</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">str_address</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;expression for breakpoint is not valid&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">str_address_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str_address</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">modification_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">str_address_int</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chained_breakpoints</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">breakpoint</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">str_address_int</span> <span class="o">&lt;=</span> <span class="nb">breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">breakpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">modification_list</span> <span class="o">=</span> <span class="n">item</span>
                <span class="k">break</span>
    <span class="k">for</span> <span class="nb">breakpoint</span> <span class="ow">in</span> <span class="n">modification_list</span><span class="p">:</span>
        <span class="n">found_breakpoint</span> <span class="o">=</span> <span class="n">get_breakpoints_in_range</span><span class="p">(</span><span class="nb">breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_breakpoint</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no such breakpoint exists for address &quot;</span> <span class="o">+</span> <span class="n">str_address</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">breakpoint_number</span> <span class="o">=</span> <span class="n">found_breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="n">modify_what</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_MODIFY</span><span class="o">.</span><span class="n">CONDITION</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please set condition first&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;condition &quot;</span> <span class="o">+</span> <span class="n">breakpoint_number</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">condition</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">modify_what</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_MODIFY</span><span class="o">.</span><span class="n">ENABLE</span><span class="p">:</span>
            <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;enable &quot;</span> <span class="o">+</span> <span class="n">breakpoint_number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">modify_what</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_MODIFY</span><span class="o">.</span><span class="n">DISABLE</span><span class="p">:</span>
            <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;disable &quot;</span> <span class="o">+</span> <span class="n">breakpoint_number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">modify_what</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_MODIFY</span><span class="o">.</span><span class="n">ENABLE_ONCE</span><span class="p">:</span>
            <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;enable once &quot;</span> <span class="o">+</span> <span class="n">breakpoint_number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">modify_what</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_MODIFY</span><span class="o">.</span><span class="n">ENABLE_COUNT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please set count first&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Count can&#39;t be lower than 1&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;enable count &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">breakpoint_number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">modify_what</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_MODIFY</span><span class="o">.</span><span class="n">ENABLE_DELETE</span><span class="p">:</span>
            <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;enable delete &quot;</span> <span class="o">+</span> <span class="n">breakpoint_number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameter modify_what is not valid&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="delete_breakpoint">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.delete_breakpoint">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_breakpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deletes a breakpoint at the address evaluated by the given expression</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the breakpoint has been deleted successfully, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">str_address</span> <span class="o">=</span> <span class="n">examine_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">address</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">str_address</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;expression for breakpoint is not valid&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">str_address_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str_address</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">deletion_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">str_address_int</span><span class="p">]]</span>
    <span class="k">global</span> <span class="n">chained_breakpoints</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chained_breakpoints</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">breakpoint</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">str_address_int</span> <span class="o">&lt;=</span> <span class="nb">breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">breakpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">deletion_list</span> <span class="o">=</span> <span class="n">item</span>
                <span class="k">del</span> <span class="n">chained_breakpoints</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="k">break</span>
    <span class="k">for</span> <span class="nb">breakpoint</span> <span class="ow">in</span> <span class="n">deletion_list</span><span class="p">:</span>
        <span class="n">found_breakpoint</span> <span class="o">=</span> <span class="n">get_breakpoints_in_range</span><span class="p">(</span><span class="nb">breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_breakpoint</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no such breakpoint exists for address &quot;</span> <span class="o">+</span> <span class="n">str_address</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">breakpoint_number</span> <span class="o">=</span> <span class="n">found_breakpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">number</span>
        <span class="k">global</span> <span class="n">breakpoint_on_hit_dict</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">breakpoint_on_hit_dict</span><span class="p">[</span><span class="n">breakpoint_number</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;delete &quot;</span> <span class="o">+</span> <span class="n">breakpoint_number</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="track_watchpoint">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.track_watchpoint">[docs]</a>
<span class="nd">@execute_with_temporary_interruption</span>
<span class="k">def</span><span class="w"> </span><span class="nf">track_watchpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">watchpoint_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starts tracking a value by setting a watchpoint at the address holding it</span>
<span class="sd">    Use get_track_watchpoint_info() to get info about the watchpoint you set</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        length (int): Length of the watchpoint</span>
<span class="sd">        watchpoint_type (int): Can be a member of typedefs.WATCHPOINT_TYPE</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Numbers of the successfully set breakpoints as strings</span>
<span class="sd">        None: If fails to set any watchpoint</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">breakpoints</span> <span class="o">=</span> <span class="n">add_watchpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">watchpoint_type</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_ON_HIT</span><span class="o">.</span><span class="n">FIND_CODE</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">breakpoints</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="nb">breakpoint</span> <span class="ow">in</span> <span class="n">breakpoints</span><span class="p">:</span>
        <span class="n">send_command</span><span class="p">(</span>
            <span class="s2">&quot;commands &quot;</span> <span class="o">+</span> <span class="nb">breakpoint</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">pince-get-track-watchpoint-info &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">breakpoints</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">c&amp;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">end&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">breakpoints</span></div>



<div class="viewcode-block" id="get_track_watchpoint_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_track_watchpoint_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_track_watchpoint_info</span><span class="p">(</span><span class="n">watchpoint_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gathers the information for the tracked watchpoint(s)</span>

<span class="sd">    Args:</span>
<span class="sd">        watchpoint_list (list): A list that holds the watchpoint numbers, must be returned from track_watchpoint()</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Holds the program counter addresses at the moment watchpoint hits as keys</span>
<span class="sd">        Format of dict--&gt; {address1:info_list1, address2:info_list2, ...}</span>
<span class="sd">        Format of info_list--&gt; [count, previous_pc_address, register_info, float_info, disas_info]</span>
<span class="sd">        count--&gt;(int) Count of the hits for the same pc address</span>
<span class="sd">        previous_pc_address--&gt;(str) The address of the instruction that comes before the instruction pc address</span>
<span class="sd">        holds. If there&#39;s no previous address available(end of region etc.), previous_pc_address=pc_address</span>
<span class="sd">        register_info--&gt;(dict) Same dict returned from read_registers()</span>
<span class="sd">        float_info--&gt;(dict) Same dict returned from read_float_registers()</span>
<span class="sd">        disas_info--&gt;(str) A small section that&#39;s disassembled just after previous_pc_counter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">track_watchpoint_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_track_watchpoint_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">,</span> <span class="n">watchpoint_list</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">track_watchpoint_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">output</span></div>



<div class="viewcode-block" id="track_breakpoint">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.track_breakpoint">[docs]</a>
<span class="nd">@execute_with_temporary_interruption</span>
<span class="k">def</span><span class="w"> </span><span class="nf">track_breakpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">register_expressions</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starts tracking a value by setting a breakpoint at the address holding it</span>
<span class="sd">    Use get_track_breakpoint_info() to get info about the breakpoint you set</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>
<span class="sd">        register_expressions (str): Register expressions, separated by a comma. Registers should start with &quot;$&quot;</span>
<span class="sd">        PINCE will gather info about values presented by register expressions every time the breakpoint is reached</span>
<span class="sd">        For instance, passing &quot;$rax,$rcx+5,$rbp+$r12&quot; will make PINCE track values rax, rcx+5 and rbp+r12</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Number of the breakpoint set</span>
<span class="sd">        None: If fails to set any breakpoint</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">breakpoint</span> <span class="o">=</span> <span class="n">add_breakpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">on_hit</span><span class="o">=</span><span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_ON_HIT</span><span class="o">.</span><span class="n">FIND_ADDR</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">breakpoint</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># TODO (lldb): When we switch to LLDB, remove c&amp; and only continue if there isn&#39;t an active trace</span>
    <span class="c1"># Apply the same for track_watchpoint</span>
    <span class="n">send_command</span><span class="p">(</span>
        <span class="s2">&quot;commands &quot;</span>
        <span class="o">+</span> <span class="nb">breakpoint</span>
        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">pince-get-track-breakpoint-info &quot;</span>
        <span class="o">+</span> <span class="n">register_expressions</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
        <span class="o">+</span> <span class="nb">breakpoint</span>
        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">c&amp;&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">end&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">breakpoint</span></div>



<div class="viewcode-block" id="get_track_breakpoint_info">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_track_breakpoint_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_track_breakpoint_info</span><span class="p">(</span><span class="nb">breakpoint</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gathers the information for the tracked breakpoint</span>

<span class="sd">    Args:</span>
<span class="sd">        breakpoint (str): breakpoint number, must be returned from track_breakpoint()</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Holds the register expressions as keys and their info as values</span>
<span class="sd">        Format of dict--&gt; {expression1:expression_info_dict1, expression2:expression_info_dict2, ...}</span>
<span class="sd">        expression--&gt;(str) The register expression</span>
<span class="sd">        Format of expression_info_dict--&gt; {value1:count1, value2:count2, ...}</span>
<span class="sd">        value--&gt;(str) Value calculated by given register expression as hex str</span>
<span class="sd">        count--&gt;(int) How many times this expression has been reached</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">track_breakpoint_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_track_breakpoint_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">,</span> <span class="nb">breakpoint</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">track_breakpoint_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">output</span></div>



<div class="viewcode-block" id="Tracer">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.Tracer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Tracer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use set_breakpoint after init and if it succeeds, use tracer_loop within a thread</span>
<span class="sd">        There can be only one trace session at a time. Don&#39;t create new trace sessions before finishing the last one&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_trace_count</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_condition</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_mode</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">STEP_MODE</span><span class="o">.</span><span class="n">SINGLE_STEP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_after_trace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_registers</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_status</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">TRACE_STATUS</span><span class="o">.</span><span class="n">IDLE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_trace_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_data</span> <span class="o">=</span> <span class="p">([],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">change_trace_status</span><span class="p">(</span><span class="n">currentpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_status</span><span class="p">)</span>

<div class="viewcode-block" id="Tracer.set_breakpoint">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.Tracer.set_breakpoint">[docs]</a>
    <span class="nd">@execute_with_temporary_interruption</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_breakpoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_trace_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">trigger_condition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">stop_condition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">step_mode</span><span class="p">:</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">STEP_MODE</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">STEP_MODE</span><span class="o">.</span><span class="n">SINGLE_STEP</span><span class="p">,</span>
        <span class="n">stop_after_trace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">collect_registers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the breakpoint for tracing instructions at the address evaluated by the given expression</span>

<span class="sd">        Args:</span>
<span class="sd">            expression (str): Any gdb expression</span>
<span class="sd">            max_trace_count (int): Maximum number of steps taken while tracing. Must be greater than or equal to 1</span>
<span class="sd">            trigger_condition (str): Optional, any gdb expression. Tracing will start if the condition is met</span>
<span class="sd">            stop_condition (str): Optional, any gdb expression. Tracing will stop whenever the condition is met</span>
<span class="sd">            step_mode (int): Can be a member of typedefs.STEP_MODE</span>
<span class="sd">            stop_after_trace (bool): Inferior won&#39;t be continuing after the tracing process</span>
<span class="sd">            collect_registers (bool): Collect registers while stepping</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Number of the breakpoint set</span>
<span class="sd">            None: If fails to set any breakpoint or if max_trace_count is not valid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_trace_count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;max_trace_count must be greater than or equal to 1&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_trace_count</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;max_trace_count must be an integer&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="nb">breakpoint</span> <span class="o">=</span> <span class="n">add_breakpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">on_hit</span><span class="o">=</span><span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_ON_HIT</span><span class="o">.</span><span class="n">TRACE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">breakpoint</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">modify_breakpoint</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">BREAKPOINT_MODIFY</span><span class="o">.</span><span class="n">CONDITION</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="n">trigger_condition</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_trace_count</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_condition</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_mode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_after_trace</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collect_registers</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">max_trace_count</span><span class="p">,</span> <span class="n">stop_condition</span><span class="p">,</span> <span class="n">step_mode</span><span class="p">,</span> <span class="n">stop_after_trace</span><span class="p">,</span> <span class="n">collect_registers</span><span class="p">)</span>
        <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;commands &quot;</span> <span class="o">+</span> <span class="nb">breakpoint</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">pince-trace-instructions</span><span class="se">\n</span><span class="s2">end&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">breakpoint</span></div>


<div class="viewcode-block" id="Tracer.tracer_loop">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.Tracer.tracer_loop">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tracer_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The main tracer loop, call within a thread&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_trace_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">trace_status_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_trace_status_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_status</span> <span class="o">!=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">TRACE_STATUS</span><span class="o">.</span><span class="n">IDLE</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span> <span class="ow">or</span> <span class="n">currentpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">trace_status_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trace_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trace_status</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trace_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">active_trace</span>
        <span class="n">active_trace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">delete_breakpoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_status</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">TRACE_STATUS</span><span class="o">.</span><span class="n">TRACING</span>

        <span class="c1"># The reason we don&#39;t use a tree class is to make the tree json-compatible</span>
        <span class="c1"># tree format--&gt;[node1, node2, node3, ...]</span>
        <span class="c1"># node--&gt;[(line_info, register_dict), parent_index, child_index_list]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Avoid calling len()</span>
        <span class="n">current_root_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">root_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Root always be an empty node, it&#39;s up to you to use or delete it</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]])</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># In case process exits during the trace session</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_trace_count</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span> <span class="ow">or</span> <span class="n">currentpid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">line_info</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;x/i $pc&quot;</span><span class="p">,</span> <span class="n">cli_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">collect_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_registers</span><span class="p">:</span>
                    <span class="n">collect_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">read_registers</span><span class="p">())</span>
                    <span class="n">collect_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">read_float_registers</span><span class="p">())</span>
                <span class="n">current_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">line_info</span><span class="p">,</span> <span class="n">collect_dict</span><span class="p">),</span> <span class="n">current_root_index</span><span class="p">,</span> <span class="p">[]])</span>
                <span class="n">tree</span><span class="p">[</span><span class="n">current_root_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span>  <span class="c1"># Add a child</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_trace_count</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">trace_instructions_ret</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line_info</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">current_root_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># If no parents exist</span>
                        <span class="n">current_index</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">tree</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">current_root_index</span><span class="p">]])</span>
                        <span class="n">tree</span><span class="p">[</span><span class="n">current_root_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_index</span>  <span class="c1"># Set new parent</span>
                        <span class="n">current_root_index</span> <span class="o">=</span> <span class="n">current_index</span>  <span class="c1"># current_node=current_node.parent</span>
                        <span class="n">root_index</span> <span class="o">=</span> <span class="n">current_root_index</span>  <span class="c1"># set new root</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">current_root_index</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">current_root_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># current_node=current_node.parent</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_mode</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">STEP_MODE</span><span class="o">.</span><span class="n">SINGLE_STEP</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">regexes</span><span class="o">.</span><span class="n">trace_instructions_call</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line_info</span><span class="p">):</span>
                        <span class="n">current_root_index</span> <span class="o">=</span> <span class="n">current_index</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_condition</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">parse_and_eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_condition</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_mode</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">STEP_MODE</span><span class="o">.</span><span class="n">SINGLE_STEP</span><span class="p">:</span>
                    <span class="n">step_instruction</span><span class="p">()</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_mode</span> <span class="o">==</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">STEP_MODE</span><span class="o">.</span><span class="n">STEP_OVER</span><span class="p">:</span>
                    <span class="n">step_over_instruction</span><span class="p">()</span>
                <span class="n">wait_for_stop</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">root_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_status</span> <span class="o">=</span> <span class="n">typedefs</span><span class="o">.</span><span class="n">TRACE_STATUS</span><span class="o">.</span><span class="n">FINISHED</span>
        <span class="n">active_trace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_after_trace</span><span class="p">:</span>
            <span class="n">continue_inferior</span><span class="p">()</span></div>


<div class="viewcode-block" id="Tracer.cancel_trace">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.Tracer.cancel_trace">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prematurely ends the trace session, trace data will still be collected&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span> <span class="o">=</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="call_function_from_inferior">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.call_function_from_inferior">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">call_function_from_inferior</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calls the given function expression from the inferior</span>

<span class="sd">    Args:</span>
<span class="sd">        expression (str): Any gdb expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing assigned value and result, both as str</span>
<span class="sd">        Returns a tuple of (False, False) if the call fails</span>

<span class="sd">    Examples:</span>
<span class="sd">        call_function_from_inferior(&quot;printf(&#39;123&#39;)&quot;) returns (&quot;$26&quot;,&quot;3&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">execute_func_temporary_interruption</span><span class="p">(</span><span class="n">send_command</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;call (void*(*)(char*, int)) </span><span class="si">{</span><span class="n">expression</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">filtered_result</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">convenience_variable</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filtered_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filtered_result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">filtered_result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="find_entry_point">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.find_entry_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_entry_point</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds entry point of the inferior</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Entry point as hex str</span>
<span class="sd">        None: If fails to find an entry point</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;info file&quot;</span><span class="p">)</span>
    <span class="n">filtered_result</span> <span class="o">=</span> <span class="n">regexes</span><span class="o">.</span><span class="n">entry_point</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filtered_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filtered_result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="search_opcode">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.search_opcode">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">search_opcode</span><span class="p">(</span><span class="n">searched_str</span><span class="p">,</span> <span class="n">starting_address</span><span class="p">,</span> <span class="n">ending_address_or_offset</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enable_regex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Searches for the given str in the disassembled output</span>

<span class="sd">    Args:</span>
<span class="sd">        searched_str (str): String that will be searched</span>
<span class="sd">        starting_address (str): Any gdb expression</span>
<span class="sd">        ending_address_or_offset (str): If you pass this parameter as an offset, you should add &quot;+&quot; in front of it</span>
<span class="sd">        (e.g &quot;+42&quot; or &quot;+0x42&quot;). If you pass this parameter as an hex address, the address range between the expression</span>
<span class="sd">        and the secondary address is disassembled.</span>
<span class="sd">        If the second parameter is an address. it always should be bigger than the first address.</span>
<span class="sd">        case_sensitive (bool): If True, search will be case sensitive</span>
<span class="sd">        enable_regex (bool): If True, searched_str will be treated as a regex expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of str values in this format--&gt;[[address1,opcodes1],[address2, ...], ...]</span>
<span class="sd">        None: If enable_regex is True and given regex isn&#39;t valid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">enable_regex</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">searched_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">searched_str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An exception occurred while trying to compile the given regex</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span>
    <span class="n">returned_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">disas_output</span> <span class="o">=</span> <span class="n">disassemble</span><span class="p">(</span><span class="n">starting_address</span><span class="p">,</span> <span class="n">ending_address_or_offset</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">disas_output</span><span class="p">:</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">enable_regex</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">opcode</span><span class="p">):</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">opcode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">searched_str</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">opcode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">searched_str</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
        <span class="n">returned_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">address</span><span class="p">,</span> <span class="n">opcode</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">returned_list</span></div>



<div class="viewcode-block" id="dissect_code">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.dissect_code">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dissect_code</span><span class="p">(</span><span class="n">region_list</span><span class="p">,</span> <span class="n">discard_invalid_strings</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Searches given regions for jumps, calls and string references</span>
<span class="sd">    Use function get_dissect_code_data() to gather the results</span>

<span class="sd">    Args:</span>
<span class="sd">        region_list (list): A list of (start_address, end_address) -&gt; (str, str)</span>
<span class="sd">        Can be returned from functions like utils.filter_regions</span>
<span class="sd">        discard_invalid_strings (bool): Entries that can&#39;t be decoded as utf-8 won&#39;t be included in referenced strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-dissect-code&quot;</span><span class="p">,</span> <span class="n">send_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_contents_send</span><span class="o">=</span><span class="p">(</span><span class="n">region_list</span><span class="p">,</span> <span class="n">discard_invalid_strings</span><span class="p">))</span></div>



<div class="viewcode-block" id="get_dissect_code_status">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_dissect_code_status">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dissect_code_status</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the current state of dissect code process</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple:(current_region, current_region_count, referenced_strings_count,</span>
<span class="sd">                               referenced_jumps_count, referenced_calls_count)</span>

<span class="sd">        current_region--&gt;(str) Currently scanned memory region</span>
<span class="sd">        current_region_count--&gt;(str) &quot;Region x of y&quot;</span>
<span class="sd">        current_range--&gt;(str) Currently scanned memory range(current buffer)</span>
<span class="sd">        referenced_strings_count--&gt;(int) Count of referenced strings</span>
<span class="sd">        referenced_jumps_count--&gt;(int) Count of referenced jumps</span>
<span class="sd">        referenced_calls_count--&gt;(int) Count of referenced calls</span>

<span class="sd">        Returns a tuple of (&quot;&quot;, &quot;&quot;, &quot;&quot;, 0, 0, 0) if fails to gather info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dissect_code_status_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dissect_code_status_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">dissect_code_status_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">output</span></div>



<div class="viewcode-block" id="cancel_dissect_code">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.cancel_dissect_code">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cancel_dissect_code</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finishes the current dissect code process early on&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">last_gdb_command</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;pince-dissect-code&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">cancel_ongoing_command</span><span class="p">()</span></div>



<div class="viewcode-block" id="get_dissect_code_data">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.get_dissect_code_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dissect_code_data</span><span class="p">(</span><span class="n">referenced_strings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">referenced_jumps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">referenced_calls</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns shelve.DbfilenameShelf objects of referenced dicts</span>

<span class="sd">    Args:</span>
<span class="sd">        referenced_strings (bool): If True, include referenced strings in the returned list</span>
<span class="sd">        referenced_jumps (bool): If True, include referenced jumps in the returned list</span>
<span class="sd">        referenced_calls (bool): If True, include referenced calls in the returned list</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of shelve.DbfilenameShelf objects. Can be used as dicts, they are backwards compatible</span>

<span class="sd">        For instance, if you call this function with default params, you&#39;ll get this--‚ñº</span>
<span class="sd">        [referenced_strings_dict,referenced_jumps_dict,referenced_calls_dict]</span>

<span class="sd">        And if you, let&#39;s say, pass referenced_jumps as False, you&#39;ll get this instead--‚ñº</span>
<span class="sd">        [referenced_strings_dict,referenced_calls_dict]</span>

<span class="sd">        referenced_strings_dict--&gt;(shelve.DbfilenameShelf object) Holds referenced string addresses</span>
<span class="sd">        Format: {referenced_address1:referrer_address_set1, referenced_address2:referrer_address_set2, ...}</span>

<span class="sd">        referenced_jumps_dict--&gt;(shelve.DbfilenameShelf object) Holds referenced jump addresses</span>
<span class="sd">        Format: {referenced_address1:referenced_by_dict1, referenced_address2:referenced_by_dict2, ...}</span>
<span class="sd">        Format of referenced_by_dict: {address1:opcode1, address2:opcode2, ...}</span>

<span class="sd">        referenced_calls_dict--&gt;(shelve.DbfilenameShelf object) Holds referenced call addresses</span>
<span class="sd">        Format: {referenced_address1:referrer_address_set1, referenced_address2:referrer_address_set2, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">referenced_strings</span><span class="p">:</span>
        <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_referenced_strings_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">referenced_jumps</span><span class="p">:</span>
        <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_referenced_jumps_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">referenced_calls</span><span class="p">:</span>
        <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_referenced_calls_file</span><span class="p">(</span><span class="n">currentpid</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dict_list</span></div>



<div class="viewcode-block" id="search_referenced_strings">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.search_referenced_strings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">search_referenced_strings</span><span class="p">(</span>
    <span class="n">searched_str</span><span class="p">,</span> <span class="n">value_index</span><span class="o">=</span><span class="n">typedefs</span><span class="o">.</span><span class="n">VALUE_INDEX</span><span class="o">.</span><span class="n">STRING_UTF8</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enable_regex</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Searches for given str in the referenced strings</span>

<span class="sd">    Args:</span>
<span class="sd">        searched_str (str): String that will be searched</span>
<span class="sd">        value_index (int): Can be a member of typedefs.VALUE_INDEX</span>
<span class="sd">        case_sensitive (bool): If True, search will be case sensitive</span>
<span class="sd">        enable_regex (bool): If True, searched_str will be treated as a regex expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: [[referenced_address1, reference_count1, found_value1], ...]</span>
<span class="sd">        None: If enable_regex is True and searched_str isn&#39;t a valid regex expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">enable_regex</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">searched_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">searched_str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An exception occurred while trying to compile the given regex</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span>
    <span class="n">str_dict</span> <span class="o">=</span> <span class="n">get_dissect_code_data</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mem_handle</span> <span class="o">=</span> <span class="n">memory_handle</span><span class="p">()</span>
    <span class="n">returned_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">address</span><span class="p">,</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">str_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">read_memory</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">value_index</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">mem_handle</span><span class="o">=</span><span class="n">mem_handle</span><span class="p">)</span>
        <span class="n">value_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_str</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">enable_regex</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">value_str</span><span class="p">):</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">searched_str</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">searched_str</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
        <span class="n">returned_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">address</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">),</span> <span class="n">value</span><span class="p">))</span>
    <span class="n">str_dict</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">mem_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">returned_list</span></div>



<div class="viewcode-block" id="search_referenced_calls">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.search_referenced_calls">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">search_referenced_calls</span><span class="p">(</span><span class="n">searched_str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enable_regex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Searches for given str in the referenced calls</span>

<span class="sd">    Args:</span>
<span class="sd">        searched_str (str): String that will be searched</span>
<span class="sd">        case_sensitive (bool): If True, search will be case sensitive</span>
<span class="sd">        enable_regex (bool): If True, searched_str will be treated as a regex expression</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: [[referenced_address1, found_string1], ...]</span>
<span class="sd">        None: If enable_regex is True and searched_str isn&#39;t a valid regex expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">param_str</span> <span class="o">=</span> <span class="p">(</span><span class="n">searched_str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">,</span> <span class="n">enable_regex</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;pince-search-referenced-calls &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">param_str</span><span class="p">),</span> <span class="n">recv_with_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="complete_command">
<a class="viewcode-back" href="../../libpince.html#libpince.debugcore.complete_command">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">complete_command</span><span class="p">(</span><span class="n">gdb_command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tries to complete the given gdb command and returns completion possibilities</span>

<span class="sd">    Args:</span>
<span class="sd">        gdb_command (str): The gdb command that&#39;ll be completed</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Possible completions as a list of str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">returned_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;complete &quot;</span> <span class="o">+</span> <span class="n">gdb_command</span><span class="p">,</span> <span class="n">cli_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">regexes</span><span class="o">.</span><span class="n">max_completions_reached</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">returned_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">returned_list</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">PINCE</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">libpince</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html#gui-utils">GUI.Utils</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, PINCE Contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>